var joosetop=this;Joose=function(){this.top=joosetop;this.anonymouseClassCounter=0};Joose.A={};Joose.A.each=function(D,C,B){for(var A=0;A<D.length;A++){C.call(B||this,D[A],A)}};Joose.A.exists=function(C,B){for(var A=0;A<C.length;A++){if(C[A]==B){return true}}return false};Joose.A.concat=function(A,B){A.push.apply(A,B);return A};Joose.A.grep=function(C,B){var A=[];Joose.A.each(C,function(D){if(B(D)){A.push(D)}});return A};Joose.A.remove=function(C,B){var A=[];Joose.A.each(C,function(D){if(D!==B){A.push(D)}});return A};Joose.S={};Joose.S.uppercaseFirst=function(A){var C=A.substr(0,1);var B=A.substr(1,A.length-1);C=C.toUpperCase();return C+B};Joose.S.isString=function(A){if(typeof A=="string"){return true}return false};Joose.O={};Joose.O.each=function(A,C){for(var B in A){C(A[B],B)}};Joose.O.eachSafe=function(A,E,C){var D=false;for(var B in A){if(A.hasOwnProperty(B)){if(B=="toString"){D=true}E.call(C||this,A[B],B)}}if(!D&&A.hasOwnProperty("toString")){E.call(C||this,A.toString,"toString")}};Joose.O.extend=function(D,C){for(var B in C){var A=C[B];D[B]=A}};Joose.F={};Joose.F.createDelegate=function(C,B,D,A){return function(){var E;if(A){E=Array.prototype.slice(arguments).concat(D)}else{E=D}C.apply(B||joose.top,E)}};Joose.prototype={addToString:function(A,B){A.toString=B},isInstance:function(A){if(!A.meta){throw"isInstance only works with Joose objects and classes."}return A.constructor===A.meta.c},init:function(){this.builder=new Joose.Builder();this.builder.globalize()},components:function(){return["Joose.Kernel.ProtoMeta","Joose.Kernel.Inheritable","Joose.Kernel.ProtoMethod","Joose.Kernel.ProtoAttribute","Joose.Kernel.Inheritance","Joose.Kernel.ProtoClassMethod","Joose.Kernel.ClassMethods","Joose.Kernel.Handlers","Joose.Kernel.Roles","Joose.Kernel.ProtoModule","Joose.Kernel.NamespaceKeeper","Joose.Kernel.MetaClass","Joose.Kernel.ProtoRole","Joose.Kernel.MetaClass.Depended","Joose.Kernel.MetaClass.Depended.Grouped","Joose.Kernel.MetaClass.Depended.Transport.ScriptTag","Joose.Kernel.MetaClass.Depended.Transport.AjaxAsync","Joose.Attribute","Joose.Method","Joose.ClassMethod","Joose.Class","Joose.TypeConstraint","Joose.Builder","Joose.TypeCoercion","Joose.Types","Joose.Role","Joose.Singleton","Joose.SimpleRequest","Joose.Gears","Joose.Storage","Joose.Storage.Unpacker","Joose.Decorator","Joose.TypeChecker","Joose.Prototype","Joose.TypedMethod","Joose.MultiMethod","Digest.MD5"]},loadComponents:function(B){var A="";Joose.A.each(this.components(),function(D){var C=""+B+"/"+D.split(".").join("/")+".js";A+='<script type="text/javascript" src="'+C+'"><\/script>'});document.write(A)}};Joose.copyObject=function(B,C){var A="";Joose.O.each(B,function(E,D){A+=", "+D;C[D]=E});return C};Joose.emptyFunction=function(){};this.joose=new Joose();(function(){if(typeof this["load"]=="function"&&(typeof this["Packages"]=="function"||typeof this["Packages"]=="object")){joose.CHAOTIC_TRAVERSION_ORDER=true}})();Joose.Kernel=Joose.Kernel||function(){throw new Error("Modules may not be instantiated.")};Joose.Kernel.ProtoMeta=function(){this.initialize.apply(this,arguments)};Joose.Kernel.ProtoMeta.prototype={_name:"Joose.Kernel.ProtoMeta",attributes:{},methods:{},constructor:Joose.Kernel.ProtoMeta,meta:Joose.Kernel.ProtoMeta,c:null,initialize:function(B){if(!B){throw ("MetaClass cant be instantiated without c")}this.c=B;var A=this.constructor.prototype;Joose.O.eachSafe(A,function(D,C){if(C!="constructor"&&C!="meta"){if(typeof A[C]=="function"){this.addMethod(C,A[C])}else{this.addAttribute(C,A[C])}}},this)},addMethod:function(A,B){if(typeof B!="function"){throw"Trying to add something else but not method"}this.methods[A]=B;this.c.prototype[A]=B},addAttribute:function(A,B){this.attributes[A]=B;this.c.prototype[A]=B},hasMethod:function(A){return this.methods.hasOwnProperty(A)},hasAttribute:function(A){return this.attributes.hasOwnProperty(A)},className:function(){return this._name},getName:function(){return this.className()},toString:function(){if(this.meta){return"a "+this.meta.className()}return"NoMeta"}};Joose.Kernel.ProtoMeta=new Joose.Kernel.ProtoMeta(Joose.Kernel.ProtoMeta);Joose.Kernel.ProtoMeta.meta=Joose.Kernel.ProtoMeta;Joose.Kernel.ProtoMeta.constructor.meta=Joose.Kernel.ProtoMeta;Joose.Kernel.ProtoMeta.constructor.prototype.meta=Joose.Kernel.ProtoMeta;Joose.Kernel.ProtoMeta=Joose.Kernel.ProtoMeta.constructor;Joose.Kernel.ProtoMeta.meta.addMethod("extend",function(A){Joose.O.eachSafe(A,function(B,C){if(C!="meta"&&C!="constructor"){typeof A[C]=="function"?this.addMethod(C,A[C]):this.addAttribute(C,A[C])}},this)});Joose.Kernel.ProtoMeta.meta.extend({adoptNextGeneration:function(){var A=this.c;A.prototype.constructor=A;A.prototype.meta=this;A.meta=this;if(!A.hasOwnProperty("toString")){A.toString=function(){return this.meta.className()}}return A},getClassObject:function(){return this.c},dieIfString:function(A){if(Joose.S.isString(A)){throw new TypeError("Parameter must not be a string.")}},classIsa:function(A){this.dieIfString(A);return this.c==A}});var inheritableMeta=new Joose.Kernel.ProtoMeta(function(A,B){this.initialize.apply(this,arguments);this.meta.initialize.call(this,this.c)});inheritableMeta.extend({parentClasses:null,initialize:function(A,B){this.parentClasses=[];this.attributes={},this.methods={};this._name=A||"__anonymous__";this.c=B||this.defaultClassFunctionBody();this.adoptNextGeneration()},defaultClassFunctionBody:function(){return function(){this.initialize.apply(this,arguments)}},classIsa:function(B){this.dieIfString(B);if(this.c==B){return true}for(var A=0;A<this.parentClasses.length;A++){if(this.parentClasses[A].meta.classIsa(B)){return true}}return false},isa:function(A){this.dieIfString(A);return this.classIsa(A)},instantiate:function(){var A=function(){};A.prototype=this.c.prototype;var B=new A();this.c.apply(B,arguments);return B},getAttributes:function(){return this.attributes},getAttribute:function(A){return this.attributes.hasOwnProperty(A)?this.attributes[A]:undefined},getMethodObject:function(A){return this.methods.hasOwnProperty(A)?this.methods[A]:undefined},getMethodNames:function(){var A=[];Joose.O.eachSafe(this.methods,function(C,B){A.push(B)});return A},getAttributeNames:function(){var A=[];Joose.O.eachSafe(this.attributes,function(C,B){A.push(B)});return A},getSuperClasses:function(){return this.parentClasses},getSuperClass:function(){return this.parentClasses[0]},classNameToClassObject:function(D){var F=joose.top;var E=D.split(".");var B=F;for(var C=0;C<E.length;C++){var A=E[C];B=B[A];if(!B){throw"Unable to find class "+D}}return B}});inheritableMeta.adoptNextGeneration();inheritableMeta._name="Joose.Kernel.Inheritable";Joose.Kernel.Inheritable=inheritableMeta.getClassObject();var protoMethodMeta=new Joose.Kernel.Inheritable("Joose.Kernel.ProtoMethod",function(A,B){this.initialize(A,B)});protoMethodMeta.extend({_name:null,_body:null,_props:null,_isFromSuperClass:false,getName:function(){return this._name},getBody:function(){return this._body},getProps:function(){return this._props},isFromSuperClass:function(){return this._isFromSuperClass},setIsFromSuperClass:function(A){this._isFromSuperClass=A},copy:function(A){return new (A||this.constructor)(this.getName(),this.getBody(),this.getProps())},initialize:function(A,C,B){this._name=A;this._body=C;this._props=B;C.name=A},apply:function(A,B){return this._body.apply(A,B)},addToClass:function(A){A.meta.methods[this.getName()]=this;A.prototype[this.getName()]=this.asFunction()},asFunction:function(){return this._body},_makeWrapped:function(A){return new this.constructor(this.getName(),A)},around:function(A){var C=this.getBody();return this._makeWrapped(function B(){var E=this;var D=function(){return C.apply(E,arguments)};return A.apply(this,Joose.A.concat([D],arguments))})},before:function(B){var C=this.getBody();return this._makeWrapped(function A(){B.apply(this,arguments);return C.apply(this,arguments)})},after:function(B){var C=this.getBody();return this._makeWrapped(function A(){var D=C.apply(this,arguments);B.apply(this,arguments);return D})},override:function(B){var C=this.getBody();return this._makeWrapped(function A(){var F=this;var E=function(){return C.apply(F,arguments)};var G=this.SUPER;this.SUPER=E;var D=B.apply(this,arguments);this.SUPER=G;return D})},augment:function(B){var C=this.getBody();return this._makeWrapped(function A(){var H=C;var F=this;var D=B;if(!this.__INNER_STACK__){this.__INNER_STACK__=[]}this.__INNER_STACK__.push(D);var G=this.INNER;this.INNER=function(){return F.__INNER_STACK__.pop().apply(F,arguments)};var E=C.apply(this,arguments);this.INNER=G;return E})}});Joose.Kernel.ProtoMethod=protoMethodMeta.getClassObject();var protoAttributeMeta=new Joose.Kernel.Inheritable("Joose.Kernel.ProtoAttribute",function(A,B){this.initialize(A,B)});protoAttributeMeta.extend({_name:null,_props:null,getName:function(){return this._name},getProps:function(){return this._props},initialize:function(A,B){this._name=A;this._props=B||{}},copy:function(A){return new A(this.getName(),this.getProps())},handleInit:function(C){var B=this.getProps();var A=this.getName();C.prototype[A]=null;if(typeof B.init!="undefined"){C.prototype[A]=B.init}},handleProps:function(A){this.handleInit(A)},addToClass:function(A){A.meta.attributes[this.getName()]=this;this.handleProps(A)},doInitialization:function(B,A){},isPersistent:function(){return this.getProps().persistent!=false}});Joose.Kernel.ProtoAttribute=protoAttributeMeta.getClassObject();var inheritanceMeta=new Joose.Kernel.Inheritable("Joose.Kernel.Inheritance");inheritanceMeta.addAttribute("methodMetaClass",Joose.Kernel.ProtoMethod);inheritanceMeta.addAttribute("attributeMetaClass",Joose.Kernel.ProtoAttribute);inheritanceMeta.extend({addSuperClass:function(E){this.dieIfString(E);if(!E.meta.meta.hasMethod("isa")||!E.meta.meta.hasMethod("getMethodObject")){throw"Class "+E+"can't be used as parent class"}var D=this;var F=E.meta.getMethodNames();for(var C=0;C<F.length;C++){var B=F[C];var A=E.meta.getMethodObject(B);if(typeof A=="function"){A=new this.methodMetaClass(B,A)}if(A){var G=A.copy(this.methodMetaClass);G.setIsFromSuperClass(true);D.addMethodObject(G)}}Joose.O.eachSafe(E.meta.attributes,function(J,I){var H=J;if(!(J&&J.meta&&J.constructor==J.meta.c)){H=new D.attributeMetaClass(I,{init:I=="attributes"?null:H,lazy:true})}else{H=H.copy(D.attributeMetaClass)}D.addAttributeObject(H)});this.parentClasses.unshift(E)},addMethod:function(B,C){var A=new this.methodMetaClass(B,C);this.addMethodObject(A)},addMethodObject:function(A){A.addToClass(this.c)},attributeMetaclass:function(){return this.attributeMetaClass},addAttribute:function(B,C){var A=new this.attributeMetaClass(B,{init:C});this.addAttributeObject(A)},addAttributeObject:function(A){A.addToClass(this.c)},setAttribute:function(A,B){return this.attributes[A]=B},wrapMethod:function(B,D,C,A){var E=this.getMethodObject(B);if(E){this.addMethodObject(E[D](C))}else{if(A){A()}else{throw new Error("Unable to apply "+D+" method modifier because method "+B+" does not exist")}}},makeAnonSubclass:function(){var A=new this.constructor(this.className()+"__anon__"+joose.anonymouseClassCounter++);A.addSuperClass(this.getClassObject());return A.getClassObject()},dispatch:function(A){return this.getMethodObject(A).asFunction()}});inheritanceMeta.parentClasses.unshift(Joose.Kernel.Inheritable);Joose.Kernel.Inheritance=inheritanceMeta.getClassObject();var protoClassMethodMeta=new Joose.Kernel.Inheritance("Joose.Kernel.ProtoClassMethod");protoClassMethodMeta.addSuperClass(Joose.Kernel.ProtoMethod);protoClassMethodMeta.extend({addToClass:function(A){A.meta.classMethods[this.getName()]=this;A[this.getName()]=this.asFunction()}});Joose.Kernel.ProtoClassMethod=protoClassMethodMeta.getClassObject();var classMethodsMeta=new Joose.Kernel.Inheritance("Joose.Kernel.ClassMethods");classMethodsMeta.addSuperClass(Joose.Kernel.Inheritance);classMethodsMeta.addAttribute("classMethods",null);classMethodsMeta.addAttribute("classMethodMetaClass",Joose.Kernel.ProtoClassMethod);classMethodsMeta.wrapMethod("initialize","after",function(){this.classMethods={}});classMethodsMeta.wrapMethod("addSuperClass","after",function(B){if(B.meta.meta.hasMethod("getClassMethodNames")){var C=B.meta.getClassMethodNames();for(var A=0;A<C.length;A++){var D=B.meta.getClassMethodObject(C[A]).copy(this.classMethodMetaClass);D.setIsFromSuperClass(true);this.addMethodObject(D)}}});classMethodsMeta.extend({hasMethod:function(A){return this.methods.hasOwnProperty(A)||this.classMethods.hasOwnProperty(A)},getClassMethodNames:function(){var A=[];Joose.O.eachSafe(this.classMethods,function(C,B){A.push(B)});return A},addAttribute:function(B,C){var A=new ((C&&C.metaclass)||this.attributeMetaClass)(B,C);this.addAttributeObject(A)},addClassMethod:function(B,C){var A=new this.classMethodMetaClass(B,C);this.addMethodObject(A)},getClassMethodObject:function(A){return this.classMethods.hasOwnProperty(A)?this.classMethods[A]:undefined},getInstanceMethods:function(){var A=[];Joose.O.eachSafe(this.methods,function(B){A.push(B)});return A},getClassMethods:function(){var A=[];Joose.O.eachSafe(this.classMethods,function(B){A.push(B)});return A},can:function(A){return this.methods.hasOwnProperty(A)},classCan:function(A){return this.classMethods.hasOwnProperty(A)}});Joose.Kernel.ClassMethods=classMethodsMeta.getClassObject();var handlersMeta=new Joose.Kernel.ClassMethods("Joose.Kernel.Handlers");handlersMeta.addSuperClass(Joose.Kernel.ClassMethods);handlersMeta.addClassMethod("isa",function(A){return this.meta.classIsa(A)});handlersMeta.wrapMethod("adoptNextGeneration","after",function(){this.addToString();this.addInitializer()});handlersMeta.extend({isAbstract:{init:false},buildComplete:function(){},initializeFromProps:function(A){this._initializeFromProps(A)},_initializeFromProps:function(A){var B=this;if(A){if(joose.top.CHAOTIC_TRAVERSION_ORDER){Joose.A.each(["isa","does","has","method","methods"],function(C){if(C in A){var D=A[C];B._initializeFromProp(C,D,A);delete A[C]}})}Joose.O.eachSafe(A,function(D,C){B._initializeFromProp(C,D,A)});B.buildComplete()}},_initializeFromProp:function(E,D,C){var B=D;var A="handleProp"+E;if(this.meta.can(A)){this[A](B,C)}else{throw new Error("Called invalid builder "+E+" while creating class "+this.className())}},addToString:function(){this.addMethod("toString",function(){if(this.stringify){return this.stringify()}return"a "+this.meta.className()})},addInitializer:function(){if(!this.c.prototype.initialize){this.addMethod("initialize",this.initializer())}},initializer:function(){return function A(E){if(this.meta.isAbstract){var D=this.meta.className();throw""+D+" is an abstract class and may not instantiated."}var C=this.meta.getAttributes();for(var F in C){if(C.hasOwnProperty(F)){var B=C[F];B.doInitialization(this,E)}}}},handlePropisAbstract:function(A){this.isAbstract=A},handlePropisa:function(A){if(A==null){throw new Error("Super class is null")}this.addSuperClass(A)},handleProphas:function(D){var C=this;if(typeof D=="string"){var A=arguments[0];var B=arguments[1];C.addAttribute(A,B)}else{Joose.O.eachSafe(D,function(F,E){C.addAttribute(E,F)})}},handlePropmethod:function(A,C,B){this.addMethod(A,C,B)},handlePropmethods:function(B){var A=this;Joose.O.eachSafe(B,function(F,C){if(typeof F!=="function"){var E=F;var G;if(E instanceof Array){var D=E;G=new Joose.MultiMethod.newFromPatterns(C,D)}else{G=Joose.TypedMethod.newFromProps(C,E)}A.addMethodObject(G)}else{A.addMethod(C,F)}})},handlePropclassMethods:function(B){var A=this;Joose.O.eachSafe(B,function(C,D){A.addMethodObject(new A.classMethodMetaClass(D,C))})},handlePropbefore:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"before",D)})},handlePropafter:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"after",D)})},handleProparound:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"around",D)})},handlePropoverride:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"override",D)})},handlePropaugment:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"augment",D,function(){A.addMethod(C,D)})})}});Joose.Kernel.Handlers=handlersMeta.getClassObject();var rolesMeta=new Joose.Kernel.Handlers("Joose.Kernel.Roles");rolesMeta.initializeFromProps({isa:Joose.Kernel.Handlers,has:{roles:{init:null},myRoles:{init:null},isDetached:{init:false}},after:{initialize:function(){this.roles=[];this.myRoles=[]},adoptNextGeneration:function(){this.addDetacher()},addSuperClass:function(C){if(C.meta.meta.hasAttribute("roles")){var B=C.meta.roles;for(var A=0;A<B.length;A++){this.roles.push(B[A])}}},buildComplete:function(){this.validateClass()}},before:{buildComplete:function(){for(var A=0;A<this.roles.length;A++){this.roles[A].meta.applyMethodModifiers(this.c)}}},methods:{apply:function(A){},applyMethodModifiers:function(A){},isImplementedBy:function(B,A){},addRole:function(A){this.dieIfString(A);if(A.meta.apply(this.getClassObject())){this.roles.push(A);this.myRoles.push(A)}},getRoles:function(){return this.roles},addDetacher:function(){this.addMethod("detach",function A(){var C=this.meta;if(C.isDetached){return}var D=C.makeAnonSubclass();D.meta.isDetached=true;this.meta=D.meta;this.constructor=D;var B;if(!this.__proto__){B=this}else{B={};Joose.copyObject(this,B)}D.prototype=B;this.__proto__=D.prototype;return})},validateClass:function(){var C=this.getClassObject();var B=this;var A=true;Joose.A.each(this.roles,function(D){D.meta.isImplementedBy(C,A)})},does:function(B){for(var A=0;A<this.roles.length;A++){if(B===this.roles[A]){return true}}for(var A=0;A<this.roles.length;A++){if(this.roles[A].meta.does(B)){return true}}return false},handlePropdoes:function(B){var A=this;if(B instanceof Array){Joose.A.each(B,function(C){A.addRole(C)})}else{A.addRole(B)}}}});Joose.Kernel.Roles=rolesMeta.getClassObject();var protoModuleMeta=new Joose.Kernel.Roles("Joose.Kernel.ProtoModule");protoModuleMeta.initializeFromProps({isa:Joose.Kernel.Roles,has:{parent:{},localName:{},namespaceElements:{},container:{}},after:{initialize:function(A,B){this.namespaceElements={};this.localName=this._name.split(".").pop();this.container=this.c}},classMethods:{getCurrentNamespace:function(){var A=50;var D="getCurrentNamespace() failed with limit="+A;var C=arguments.callee.caller;while(C&&A){if(C.__JOOSE_MODULE__){return C.__JOOSE_MODULE__}try{C=C.caller}catch(B){C=null}A--}if(A){return __global__}throw D},prepareNamespace:function(D){var G=D.split(".");if(G.length&&!G[0]){G.shift()}if(!G.length){throw"Cant prepare namespace with empty name = ["+D+"]"}var C=this.getCurrentNamespace();var A=C.meta.getName().split(".");if(A.length&&!A[0]){A.shift()}for(var E=0;E<G.length;E++){var B=G[E];if(B=="meta"){throw"Module names may not include a part called 'meta'."}if(!B){throw"Module names may not include an empty part."}A.push(B);var D=A.join(".");var H=C.meta.container[B];if(typeof H=="undefined"){var F=new Joose.Kernel.NamespaceKeeper(D).getClassObject();C.meta.addElement(F.meta.localName,F)}else{if(!(H&&H.meta&&H.meta.meta&&H.meta.meta.isa(Joose.Kernel.ProtoModule))){throw"Trying to setup module "+D+" failed. There is already something: "+H}}C=C.meta.container[B]}return C},create:function(A,C){var B=Joose.Kernel.ProtoModule.prepareNamespace(A);B.meta.initializeFromProps(C);return B},executeInNamespace:function(B,D,C,E){var A=function(G,F){arguments.callee.__JOOSE_MODULE__=F;return G.apply(C||this,E||[])};return A(D,B)}},before:{addClassMethod:function(A,B){if(this.hasElement(A)){throw"Collision between existing namespace element ["+this.namespaceElements[A]+"] and a new classMethod ["+A+"]"}}},methods:{copyInternalState:function(A){A.parent=this.parent;A.namespaceElements=this.namespaceElements;A.container=this.container},handlePropbody:function(A){if(A){Joose.Kernel.ProtoModule.executeInNamespace(this.c,A,this.container,[this.c])}},handlePropversion:function(A){throw"Probably you need to include Depended Role into your deployment"},handlePropuse:function(B,A){throw"Probably you need to include Depended Role into your deployment"},dependsFrom:function(B){for(var A in this.dependencies){if(this.dependencies.hasOwnProperty(A)){if(this.dependencies[A].Module==B){return true}}}for(A in this.dependencies){if(this.dependencies.hasOwnProperty(A)){if(this.dependencies[A].Module.meta.dependsFrom(B)){return true}}}return false},alias:function(A){for(var B in this.namespaceElements){if(this.namespaceElements.hasOwnProperty(B)){if(A[B]&&A[B]!=this.namespaceElements[B]){throw"Aliasing of "+this._name+" to "+A+" failed, there is already something: "+A[B]}A[B]=this.namespaceElements[B]}}return this},hasElement:function(A){return this.namespaceElements.hasOwnProperty(A)&&Boolean(this.namespaceElements[A])},getElement:function(A){if(typeof this.container.hasOwnProperty=="function"){return this.container.hasOwnProperty(A)&&this.container[A]||null}return this.container[A]},addElement:function(A,B){if(this.classCan(A)){throw"Collision between existing classMethod ["+A+"] of "+this+" and a new namespace element ["+B+"]"}if(this.hasElement(A)){throw"Adding namespace element failed: namespace element ["+A+"] already exists in the ["+this._name+"]"}this.namespaceElements[A]=B;this.container[A]=B;if(B&&B.meta){B.meta.parent=this.c}},removeElement:function(A){var B=this.namespaceElements[A];delete B.parent;delete this.namespaceElements[A];try{delete this.container[A]}catch(C){this.container[A]=undefined}return B},getElementNames:function(){var A=[];Joose.O.eachSafe(this.namespaceElements,function(B,C){A.push(C)});return A}}});Joose.Kernel.ProtoModule=protoModuleMeta.getClassObject();var namespaceKeeperMeta=new Joose.Kernel.ProtoModule("Joose.Kernel.NamespaceKeeper");namespaceKeeperMeta.initializeFromProps({isa:Joose.Kernel.ProtoModule,has:{externalConstructor:{}},methods:{defaultClassFunctionBody:function(){return function(){if(this.meta.constructor==Joose.Kernel.NamespaceKeeper){throw new Error("Modules may not be instantiated.")}if(typeof this.meta.externalConstructor=="function"){this.meta.externalConstructor.apply(this,arguments);return}throw new Error("NamespaceKeeper was planted incorrectly.")}}}});Joose.Kernel.NamespaceKeeper=namespaceKeeperMeta.getClassObject();__global__=new Joose.Kernel.NamespaceKeeper("",function(){throw"Global NamespaceKeeper can't be instantiated"}).getClassObject();__global__.meta._name="";__global__.meta.container=joose.top;__global__.meta.parent=__global__;new Joose.Kernel.NamespaceKeeper("Joose",Joose);new Joose.Kernel.NamespaceKeeper("Joose.Kernel",Joose.Kernel);__global__.meta.addElement("Joose",Joose);Joose.meta.addElement("Kernel",Joose.Kernel);var metaClassMeta=new Joose.Kernel.ProtoModule("Joose.Kernel.MetaClass");metaClassMeta.initializeFromProps({isa:Joose.Kernel.ProtoModule,classMethods:{create:function(A,C){var B=Joose.Kernel.ProtoModule.prepareNamespace(A);var E=B.meta._name;if(B.meta.constructor==Joose.Kernel.NamespaceKeeper){var D=new this(E).getClassObject();B.meta.copyInternalState(D.meta);B.meta=D.meta;B.prototype=D.prototype;B.prototype.constructor=B;B.meta.c=B;B.meta.externalConstructor=D;Joose.A.each(D.meta.getClassMethods(),function(F){F.addToClass(B)})}B.meta.initializeFromProps(C);return B}}});Joose.Kernel.MetaClass=metaClassMeta.getClassObject();var protoRoleMeta=new Joose.Kernel.MetaClass("Joose.Kernel.ProtoRole");protoRoleMeta.initializeFromProps({isa:Joose.Kernel.MetaClass,has:{requiresMethodNames:{},methodModifiers:{},metaRoles:{}},after:{initialize:function(){this.requiresMethodNames=[];this.methodModifiers=[]}},methods:{wrapMethod:function(B,D,C,A){this.methodModifiers.push(arguments)},requiresMethod:function(B){var A=false;Joose.A.each(this.requiresMethodNames,function(C){if(B==C){A=true}});return A},addInitializer:Joose.emptyFunction,addDetacher:Joose.emptyFunction,addToString:Joose.emptyFunction,defaultClassFunctionBody:function(){return function(){throw new Error("Roles may not be instantiated.")}},addSuperClass:function(){throw new Error("Roles may not inherit from a super class.")},addRequirement:function(A){this.requiresMethodNames.push(A)},handleProprequires:function(A){var B=this;if(!this.meta.isa(Joose.Kernel.ProtoRole)){throw ("Keyword 'requires' only available classes with a meta class of type Joose.Role")}if(A instanceof Array){Joose.A.each(A,function(C){B.addRequirement(C)})}else{B.addRequirement(A)}},unapply:function(B){if(!joose.isInstance(B)){throw new Error("You way only remove roles from instances.")}if(!B.meta.isDetached){throw new Error("You may only remove roles that were applied at runtime")}var C=this.getClassObject();var E=B.meta.myRoles;var I=false;var A=[];for(var D=0;D<E.length;D++){if(E[D]===C){I=true}else{A.push(E[D])}}if(!I){throw new Error("The role "+this.className()+" was not applied to the object at runtime")}var H=B.meta.getSuperClass();var G=H.meta.makeAnonSubclass();var F=new G();for(var D=0;D<A.length;D++){var C=A[D];G.meta.addRole(C)}G.prototype=F;B.meta=G.meta;B.constructor=G;B.__proto__=F},addMethodToClass:function(D,B){var A=D.getName();var C;if(this.classMethodMetaClass.meta.isa(D.constructor)){C=B.meta.getClassMethodObject(A)}else{C=B.meta.getMethodObject(A)}if(!C||C.isFromSuperClass()){B.meta.addMethodObject(D)}},addAttributeToClass:function(A,C){var B=A.getName();if(!C.meta.hasAttribute(B)){this.getAttribute(B).addToClass(C)}},apply:function(E){if(!E.meta.meta.can("addRole")){return false}if(E.meta.does(this.getClassObject())){return false}if(joose.isInstance(E)){E.detach();E.meta.addRole(this.getClassObject());this.applyMethodModifiers(E);var B=true;this.isImplementedBy(E,B)}else{var F=this;var D=F.getAttributes();Joose.O.each(D,function C(I){F.addAttributeToClass(I,E)});var G=F.getMethodNames();Joose.A.each(G,function H(I){F.addMethodToClass(F.getMethodObject(I),E)});G=F.getClassMethodNames();Joose.A.each(G,function H(I){F.addMethodToClass(F.getClassMethodObject(I),E)});if(this.metaRoles){Joose.A.each(this.metaRoles,function A(I){I.meta.apply(E.meta)})}}return true},applyToClass:function(A){this.apply(A);this.applyMethodModifiers(A)},applyMethodModifiers:function(A){Joose.A.each(this.methodModifiers,function B(C){A.meta.wrapMethod.apply(A.meta,C)})},hasRequiredMethods:function(D,B){var C=this;var A=true;Joose.A.each(this.requiresMethodNames,function(F){var E=D.meta.can(F);if(!E){if(B){throw ("Class "+D.meta.className()+" does not fully implement the role "+C.className()+". The method is "+F+" missing.")}A=false;return}});return A},isImplementedBy:function(C,B){var A=this.hasRequiredMethods(C,B);if(A){A=this.implementsMyMethods(C)}return A},implementsMyMethods:function(B){var A=true;Joose.A.each(this.getMethodNames(),function(D){var C=B.meta.can(D);if(!C){A=false}});Joose.A.each(this.getClassMethodNames(),function(D){var C=B.meta.classCan(D);if(!C){A=false}});return A},handlePropmetaRoles:function(A){this.metaRoles=A}}});Joose.Kernel.ProtoRole=protoRoleMeta.getClassObject();Joose.Kernel.ProtoRole.create("Joose.Kernel.MetaClass.Depended",{requires:["initializeFromProps","handlePropbody"],has:{version:{},url:{},loading:{init:false},loaded:{init:false},ready:{init:false},readyListeners:{},BEGIN:{},beginStarted:{init:false},dependencies:{}},after:{initialize:function(A,B){this.dependencies={};this.readyListeners=[]},copyInternalState:function(A){A.loading=this.loading;A.loaded=this.loaded;A.ready=this.ready;A.readyListeners=this.readyListeners;A.dependencies=this.dependencies;A.BEGIN=this.BEGIN}},classMethods:{use:function(C,D,B){var A=new Joose.Kernel.MetaClass();A.initializeFromProps({use:C,body:function(){D.call(B||this)}})},prepareVirtualNamespace:function(A){if(__JOOSE_VIRTUAL_NAMESPACES__[A]){return __JOOSE_VIRTUAL_NAMESPACES__[A]}return(__JOOSE_VIRTUAL_NAMESPACES__[A]=new Joose.Kernel.MetaClass(A).getClassObject())}},override:{initializeFromProps:function(C){C=C||{};var D=this.c;this.loaded=true;this.loading=false;this._initializeFromProp("BEGIN",C.BEGIN,C);delete C.BEGIN;var A=C.body;delete C.body;if(C.use){var B=C.use;delete C.use;D.meta.readyListeners.unshift(function(){D.meta.initializeFromProps(C);D.meta._initializeFromProp("body",A,C)});D.meta._initializeFromProp("use",B,C)}else{this.SUPER(C);this.prepareDependencies();this.processDependencies();this.finalizeDependencies();this._initializeFromProp("body",A,C)}}},methods:{handlePropBEGIN:function(B,A){if(B){if(this.BEGIN){throw"Double declaration of BEGIN property for module=["+this.c+"]"}this.BEGIN=B}},handlePropversion:function(A){this.version=A},prepareDependencyDescriptor:function(thisNamespace,desc){var descriptor=desc;if(typeof descriptor=="string"){descriptor={Module:descriptor}}if(descriptor.Module&&descriptor.url){throw"Dependency of ["+thisNamespace+"] from external url=["+descriptor.url+"], can't have Module defined ["+descriptor.Module+"]"}if(/^ext:\/\//.test(descriptor.Module)){descriptor.Module=descriptor.Module.replace(/^ext:\/\//,"");var moduleName=descriptor.Module;descriptor.presence=function(){return eval(moduleName)}}var depName=descriptor.Module||descriptor.url;if(!depName){throw"Empty dependency name for Module=["+thisNamespace+"]"}descriptor.depName=depName;if(thisNamespace.meta.dependencies[depName]&&thisNamespace.meta.dependencies[depName].version!=descriptor.version){throw"Repeated usage of "+depName+" with different version number for Module=["+thisNamespace+"]"}if(!thisNamespace.meta.dependencies[depName]){if(descriptor.Module){if(descriptor.presence){descriptor.Module=Joose.Kernel.MetaClass.prepareVirtualNamespace(descriptor.Module);if(!descriptor.Module.meta.presence){descriptor.Module.meta.presence=descriptor.presence}}else{descriptor.Module=Joose.Kernel.MetaClass.executeInNamespace(__global__,function(){return Joose.Kernel.MetaClass.prepareNamespace(descriptor.Module)})}}else{descriptor.Module=Joose.Kernel.MetaClass.prepareVirtualNamespace(descriptor.url);descriptor.Module.meta.url=descriptor.url;Joose.Kernel.MetaClass.Depended.Transport.ScriptTag.meta.apply(descriptor.Module.meta)}}return descriptor},handlePropuse:function(B,A){var C=this.c;C.meta.prepareDependencies(B);C.meta.processDependencies();C.meta.finalizeDependencies()},prepareDependencies:function(A){if(!A){return}var C=this.c;var B=A;if(!(B instanceof Array)){B=[B]}Joose.A.each(B,function(D){this.processDescriptor(this.prepareDependencyDescriptor(C,D))},this)},processDescriptor:function(A){if(this.needDescriptor(A)){this.addDescriptor(A)}},needDescriptor:function(A){return !(this.dependencies[A.depName]||A.Module.meta.ready)},addDescriptor:function(D){var B=this.c;var C=D.depName;var A=D.Module;A.meta.readyListeners.push(function(){if(D.version){if(!A.meta.version){throw"Loaded descriptor "+A+" has no specified version. Required version is: "+D.version}if(A.meta.version<D.version){throw"Loaded descriptor "+A+" has lower version ["+A.meta.version+"] than required ["+D.version+"]"}}delete B.meta.dependencies[C];B.meta.finalizeDependencies()});this.dependencies[C]=D;this.ready=false},processDependencies:function(){Joose.O.eachSafe(this.dependencies,function(A){A.Module.meta.handleLoad()})},finalizeDependencies:function(){this.checkDependencies()},checkDependencies:function(){for(var A in this.dependencies){if(this.dependencies.hasOwnProperty(A)){return}}if(this.BEGIN){if(!this.beginStarted){this.beginStarted=true;var B=this;this.BEGIN.call(this.c,function(){B.beginStarted=false;delete B.BEGIN;B.fireReady()})}}else{this.fireReady()}},fireReady:function(){this.ready=true;var A=this.readyListeners;this.readyListeners=[];Joose.A.each(A,function(B){B()})},getUrls:function(){if(this.url){return typeof this.url=="function"?this.url():this.url}var B=[];var A=this._name.split(".");Joose.A.each(__JOOSE_INC__,function(C){B.push(C.concat(A).join("/")+".js"+(__JOOSE_DISABLE_CACHING__?"?disableCaching=true":""))});return B},handleLoad:function(){var C=this.c;try{if(this.loaded||typeof this.presence=="function"&&this.presence()){this.finalizeDependencies();return}}catch(E){}if(this.loading){return}this.loading=true;var D=this.getUrls();if(!(D instanceof Array)){D=[D]}var B=function(){C.meta.loaded=true;C.meta.loading=false;C.meta.finalizeDependencies()};var A=function(){if(!D.length){throw"Module=["+C+"] not found"}Joose.Kernel.MetaClass.executeInNamespace(__global__,function(){this.load(D.shift(),B,A)},C.meta)};Joose.Kernel.MetaClass.executeInNamespace(__global__,function(){this.load(D.shift(),B,A)},this)},load:function(){throw"You need to apply one of the Transporting Roles"}}});use=function(){Joose.Kernel.MetaClass.use.apply(Joose.Kernel.MetaClass,arguments)};__JOOSE_INC__=[["../localLib/root1"],["../localLib/root2"]];__JOOSE_DISABLE_CACHING__=true;__JOOSE_VIRTUAL_NAMESPACES__={};__JOOSE_LIBRARIAN_ENABLED__=false;Joose.Kernel.MetaClass.Depended.meta.applyToClass(Joose.Kernel.MetaClass);Joose.Kernel.MetaClass.Depended.meta.applyToClass(Joose.Kernel.NamespaceKeeper);Joose.Kernel.MetaClass.Depended.meta.applyToClass(Joose.Kernel.ProtoRole);Joose.Kernel.ProtoRole.create("Joose.Kernel.MetaClass.Depended.Grouped",{requires:["handlePropuse","processDependencies","addDescriptor"],has:{groupedDependencies:{}},before:{handlePropuse:function(B,A){this.groupedDependencies=this.groupedDependencies||{}}},after:{processDependencies:function(){if(this.groupedDependencies){delete this.groupedDependencies[this._name];this.handleGroupLoad()}},copyInternalState:function(A){A.dependenciesGroup=this.dependenciesGroup}},override:{handleLoad:function(){if(!this.groupedDependencies){this.SUPER()}},getUrls:function(){if(!this.groupedDependencies){return this.SUPER()}return __JOOSE_LIBRARIAN_ROOT__.concat(Digest.MD5.md5_hex(this.stringifyDependencies())+".js").join("/")},addDescriptor:function(C){this.SUPER(C);var A=C.Module.meta;var B=C.depName;if(!A.groupedDependencies&&!C.url){A.groupedDependencies=this.groupedDependencies;if(A.loaded||A.loading){return}A.loading=true;if(this.groupedDependencies[B]){if(!C.version){return}if(this.groupedDependencies[B].version>C.version){return}}this.groupedDependencies[B]=C}}},methods:{handleGroupLoad:function(){var me=this;var haveAny=false;var groupedDependencies=this.groupedDependencies;for(var i in groupedDependencies){if(groupedDependencies.hasOwnProperty(i)){haveAny=true;if(groupedDependencies[i].Module.meta.loaded){return}}}if(!haveAny){return}var req=new Joose.SimpleRequest();var me=this;try{req.getText({url:this.getUrls(),headers:{"X-Joose-Bundle":this.stringifyDependencies()},async:true,callback:function(success,text){if(!success){onerror();return}eval(text);Joose.O.eachSafe(me.groupedDependencies,function(descriptor){var dependedMeta=descriptor.Module.meta;if(descriptor.presence){dependedMeta.loaded=true;dependedMeta.loading=false}dependedMeta.finalizeDependencies()})}})}catch(e){throw"Failed to load groupedDependencies bundle: "+me.stringifyDependencies()}},stringifyDependencies:function(){var A=[];Joose.O.eachSafe(this.groupedDependencies,function(C,B){A.push((C.presence?"ext://":"")+B+(C.version?"-"+C.version:""))});A.sort();return A.join(",")}}});__JOOSE_LIBRARIAN_ENABLED__=true;__JOOSE_LIBRARIAN_ROOT__=["/librarian"];Joose.Kernel.MetaClass.Depended.Grouped.meta.applyToClass(Joose.Kernel.MetaClass);Joose.Kernel.MetaClass.Depended.Grouped.meta.applyToClass(Joose.Kernel.NamespaceKeeper);Joose.Kernel.MetaClass.Depended.Grouped.meta.applyToClass(Joose.Kernel.ProtoRole);Joose.Kernel.ProtoRole.create("Joose.Kernel.MetaClass.Depended.Transport.ScriptTag",{requires:["handleLoad"],methods:{load:function(D,C,B){var A=document.createElement("script");A.onload=A.onreadystatechange=function(){if(!A.readyState||A.readyState=="loaded"||A.readyState=="complete"||A.readyState==4&&A.status==200){setTimeout(function(){C()},1)}};A.setAttribute("type","text/javascript");A.setAttribute("src",D);document.getElementsByTagName("head")[0].appendChild(A)}}});Joose.Kernel.ProtoRole.create("Joose.Kernel.MetaClass.Depended.Transport.AjaxAsync",{requires:["handleLoad"],methods:{load:function(url,onready,onerror){var req=new Joose.SimpleRequest();try{req.getText(url,true,function(success,text){if(!success){onerror();return}eval(text);onready()})}catch(e){onerror()}}}});Joose.Kernel.MetaClass.Depended.Transport.AjaxAsync.meta.applyToClass(Joose.Kernel.MetaClass);Joose.Kernel.MetaClass.Depended.Transport.AjaxAsync.meta.applyToClass(Joose.Kernel.NamespaceKeeper);Joose.Kernel.MetaClass.Depended.Transport.AjaxAsync.meta.applyToClass(Joose.Kernel.ProtoRole);Joose.Kernel.MetaClass.create("Joose.Attribute",{isa:Joose.Kernel.ProtoAttribute,before:{handleProps:function(A){this.handleIs(A)}},after:{handleProps:function(A){this.handlePredicate(A);this.handleHandles(A)}},methods:{isPrivate:function(){return this.getName().charAt(0)=="_"},toPublicName:function(){if(this.__publicNameCache){return this.__publicNameCache}var A=this.getName();if(this.isPrivate()){this.__publicNameCache=A.substr(1);return this.__publicNameCache}this.__publicNameCache=A;return this.__publicNameCache},getIsa:function(){var A=this.getProps();if("isa" in A&&A.isa==null){throw new Error("You declared an isa property but the property is null.")}if(A.isa){if(!A.isa.meta){return A.isa()}return A.isa}return},addSetter:function(E){var F=E.meta;var B=this.getName();var C=this.getProps();var A=this.setterName();if(F.can(A)){return}var G=this.getIsa();var D=this.makeTypeChecker(G,C,"attribute",B);F.addMethod(A,D)},addGetter:function(C){var I=C.meta;var A=this.getName();var D=this.getProps();var F=this.getterName();if(I.can(F)){return}var B=function E(){return this[A]};var H=D.init;if(D.lazy){B=function G(){var J=this[A];if(typeof J=="function"&&J===H){this[A]=J.apply(this)}return this[A]}}I.addMethod(F,B)},initializerName:function(){return this.toPublicName()},getterName:function(){if(this.__getterNameCache){return this.__getterNameCache}this.__getterNameCache="get"+Joose.S.uppercaseFirst(this.toPublicName());return this.__getterNameCache},setterName:function(){if(this.__setterNameCache){return this.__setterNameCache}this.__setterNameCache="set"+Joose.S.uppercaseFirst(this.toPublicName());return this.__setterNameCache},handleIs:function(C){var A=this.getProps();var B=A.is;if(B=="rw"||B=="ro"){this.addGetter(C)}if(B=="rw"){this.addSetter(C)}},doInitialization:function(B,I){var A=this.initializerName();var G=this.getName();var F;var E=false;if(typeof I!="undefined"&&typeof I[A]!="undefined"){F=I[A];E=true}else{var D=this.getProps();var H=D.init;if(typeof H=="function"&&!D.lazy){F=H.call(B);E=true}else{if(D.required){throw"Required initialization parameter missing: "+A+"(While initializing "+B+")"}}}if(E){var C=this.setterName();if(B.meta.can(C)){B[C](F)}else{B[G]=F}}},handlePredicate:function(E){var F=E.meta;var C=this.getName();var D=this.getProps();var B=D.predicate;var A=this.getterName();if(B){F.addMethod(B,function(){var G=this[A]();return G?true:false})}},makeTypeChecker:function(F,G,H,A){var C;if(F){if(!F.meta){throw new Error("Isa declarations in attribute declarations must be Joose classes, roles or type constraints")}var I=false;var D=false;if(Joose.Role&&F.meta.meta.isa(Joose.Role)){I=true}else{if(Joose.TypeConstraint&&F.meta.isa(Joose.TypeConstraint)){D=true}}C=function B(O,L){var M=O;try{if(G.nullable===true&&M==undefined){}else{if(D){var K=null;if(G.coerce){K=F.coerce(M)}if(K==null&&G.nullable!==true){F.validate(M)}else{M=K}}else{if(!M||!M.meta){throw new ReferenceError("The attribute "+A+" only accepts values that have a meta object.")}var J=I?M.meta.does(F):M.meta.isa(F);if(!J){throw new ReferenceError("The attribute "+A+" only accepts values that are objects of type "+F.meta.className()+".")}}}}catch(N){if(L){L.call(this,N,F)}else{throw N}}this[A]=M;return this}}else{C=function E(J){this[A]=J;return this}}return C},handleHandles:function(E){var F=E.meta;var A=this.getName();var C=this.getProps();var B=C.handles;var G=C.isa;if(B){if(B=="*"){if(!G){throw"I need an isa property in order to handle a class"}var D=C.handleWith;F.decorate(G,A,D)}else{throw"Unsupported value for handles: "+B}}}}});Joose.Kernel.MetaClass.create("Joose.Method",{isa:Joose.Kernel.ProtoMethod});Joose.Kernel.MetaClass.create("Joose.ClassMethod",{isa:Joose.Kernel.ProtoClassMethod});Joose.Kernel.MetaClass.create("Joose.Class",{isa:Joose.Kernel.MetaClass,has:{attributeMetaClass:{init:Joose.Attribute},methodMetaClass:{init:Joose.Method},classMethodMetaClass:{init:Joose.ClassMethod}}});Joose.Class.create("Joose.TypeConstraint",{has:{_constraints:{is:"ro",init:function(){return[]}},_coercions:{is:"ro",init:function(){return[]}},_messages:{is:"ro",init:function(){return[]}},_callback:{is:"ro",init:function(){return function(A){throw new ReferenceError(A)}}},_name:{is:"ro"},_uses:{is:"ro"},props:{is:"rw"}},classMethods:{create:function(C,H){var F=Joose.Kernel.ProtoModule.prepareNamespace(C);var G=F.meta.parent;var B=F.meta.localName;G.meta.removeElement(B);var E=new Joose.TypeConstraint({name:C});G.meta.addElement(B,E);if(H.uses&&typeof H.uses.meta!="undefined"&&H.uses.meta.isa(Joose.TypeConstraint)){E._uses=H.uses}if(H.where){E.addConstraint(H.where,H.message)}E.setProps(H);if(H.coerce){for(var D=0;D<H.coerce.length;D++){var A=H.coerce[D];E.addCoercion(new Joose.TypeCoercion({from:A.from,via:A.via}))}}return E}},methods:{stringify:function(){return this._name},makeSubType:function(A){var B=new Joose.TypeConstraint({name:A});Joose.A.each(this._constraints,function(C){B.addConstraint(C)});return B},addCoercion:function(A){this._coercions.push(A)},addConstraint:function(B,A){this._constraints.push(B);this._messages.push(A)},getConstraintList:function(){var A=this._constraints;if(this._uses){var B=this._uses.getConstraintList();return B.concat(A)}return A},getMessageList:function(){var B=this._messages;if(this._uses){var A=this._uses.getMessageList();return A.concat(B)}return B},validateBool:function(B){var A=this._validate(B);if(A==-1){return true}return false},validate:function(D){var A=this._validate(D);if(A==-1){return true}var C=this.getMessageList();var B=C[A]?C[A].call(this,D):"The passed value ["+D+"] is not a "+this;this._callback(B)},_validate:function(F){var C=this.getConstraintList();var D,B;for(D=0,B=C.length;D<B;D++){var E=C[D];var A=false;if(E instanceof RegExp){A=E.test(F)}else{A=E.call(this,F)}if(!A){return D}}return -1},coerce:function(F){if(this.validateBool(F)){return F}var E=this._coercions;for(var D=0,B=E.length;D<B;D++){var C=E[D];var A=C.coerce(F);if(A!==null){return A}}return null}}});Joose.Builder=function(){this.globalize=function(){Joose.O.each(Joose.Builder.Globals,function(C,A){var B="Joose"+A;if(typeof joose.top[A]=="undefined"){joose.top[A]=C}joose.top[B]=C})}};Joose.Builder.Globals={Module:function(A,B){if(typeof B=="function"){B={body:B}}return Joose.Kernel.ProtoModule.create(A,B)},Role:function(A,B){if(!B.meta){B.meta=Joose.Role}return JooseClass(A,B)},Prototype:function(A,B){if(!B.meta){B.meta=Joose.Prototype}return JooseClass(A,B)},Class:function(B,C){var A;if(C&&C.meta){A=C.meta;delete C.meta}else{if(C&&C.isa&&C.isa!=Joose.Class){A=C.isa.meta.constructor}else{A=Joose.Class}}if(!A.meta.classCan("create")){throw"MetaClass ["+A+"] can't be used with Class builder (have no class method 'create')"}return A.create(B,C)},Type:function(B,C){if(typeof Joose.Type=="undefined"){JooseModule("Joose.Type")}if(typeof joose.top.TYPE=="undefined"){joose.top.TYPE=Joose.Type}var D=false;if(arguments.length==1&&B instanceof Object){C=B;D=true}if(C instanceof RegExp||C instanceof Function){C={where:C}}if(D){B="AnonType: "+(C.where?C.where.toString():"")}var A=Joose.Kernel.ProtoModule.getCurrentNamespace();if(A==__global__){A=Joose.Type}return Joose.Kernel.ProtoModule.executeInNamespace(A,Joose.TypeConstraint.create,Joose.TypeConstraint,[B,C])},joosify:function(B,C){var A=new Joose.Class(B,C);Joose.O.eachSafe(C.prototype,function(F,D){if(D=="meta"||D=="constructor"){return}if(typeof(F)=="function"){A.addMethod(D,F)}else{var E={};if(typeof(F)!="undefined"){E.init=F}A.addAttribute(D,E)}});return A.getClassObject()},rw:"rw",ro:"ro"};joose.init();(function(B,A){A("CoercionFrom",{where:function(C){if(C.meta&&C.meta.isa(Joose.TypeConstraint)){return true}return false}});B("Joose.TypeCoercion",{has:{_from:{isa:TYPE.CoercionFrom,is:"rw"},_via:{is:"rw"}},methods:{coerce:function(C){if(this._from.validateBool(C)){return this._via(C)}return null}}})})(JooseClass,JooseType);(function(A){A("Any",{where:function(B){return true}});A("Null",{uses:Joose.Type.Any,where:function(B){if(B===null){return true}return false}});A("NotNull",{uses:Joose.Type.Any,where:function(B){if(B===null){return false}return true}});A("Enum",{uses:Joose.Type.NotNull,message:function(B){return"The passed value ["+B+"] is not "+(this.getProps().strictMatch?"*strictly* ":"")+"one of ["+this.getProps().values.join(",")+"]"},where:function(D){var C=this;var E=C.getProps();if(!E||E.values===undefined||!(E.values instanceof Array)){throw"Enum Type needs Array of values in 'values' property of Type declaration"}var B=function(F){if(E.strictMatch===true){return(F===D)}return(F==D)};if(Joose.A.grep(E.values,B).length!=0){return true}return false}});A("Obj",{uses:Joose.Type.NotNull,where:function(B){if(B instanceof Object){return true}return false}});A("Str",{uses:Joose.Type.NotNull,where:function(B){if(typeof B=="string"||B instanceof String){return true}return false},coerce:[{from:Joose.Type.Any,via:function(B){if(B==null){return""}else{return""+B}}}]});A("Num",{uses:Joose.Type.NotNull,where:function(B){if(typeof B=="number"||B instanceof Number){return true}return false},coerce:[{from:Joose.Type.Str,via:function(B){if(B==null||B==""){return undefined}return parseFloat(B,10)}}]});A("Bool",{uses:Joose.Type.NotNull,where:function(C){if(C===true||C===false){return true}return false},coerce:[{from:Joose.Type.Any,via:function(B){if(B==null||B===""){return false}if(B==1||B=="1"||B=="true"){return true}if(B==0||B=="0"||B=="false"){return false}return null}}]});A("Int",{uses:Joose.Type.Num,where:function(C){var B=String(C);if(B.match(/^\d*\.\d$/)){return false}return true},coerce:[{from:Joose.Type.Str,via:function(B){if(B==null||B==""){return undefined}if(B.match(/^-{0,1}\d+$/)){return parseInt(B,10)}return}}]});A("Float",{uses:Joose.Type.Num,where:function(B){return true}});A("Func",{uses:Joose.Type.Obj,where:function(B){if(typeof B=="function"){return true}return false}});A("Array",{uses:Joose.Type.Obj,where:function(B){if(Object.prototype.toString.call(B)==="[object Array]"){return true}return false}});A("Date",{uses:Joose.Type.Obj,where:function(B){if(B instanceof Date){return true}return false},coerce:[{from:Joose.Type.Str,via:function(C){var B;if(C==undefined||C==""){return undefined}else{if(B=C.match(/\s*(\d+)-(\d+)-(\d+)/)){return new Date(B[1],B[2]-1,[B[3]])}}return null}}]});A("Joose",{uses:Joose.Type.Obj,where:function(B){if(B.meta&&B.meta.meta.isa(Joose.Class)){return true}return false}})})(JooseType);Class("Joose.Role",{isa:Joose.Kernel.ProtoRole,meta:Joose.Class,has:{attributeMetaClass:{init:Joose.Attribute},methodMetaClass:{init:Joose.Method},classMethodMetaClass:{init:Joose.ClassMethod}}});(function(C){var B={};var A=true;C("Joose.Singleton",{before:{initialize:function(){if(A){var D=this.meta.className();throw new Error("The class "+D+" is a singleton. Please use the class method getInstance().")}}},methods:{singletonInitialize:function(){}},classMethods:{getInstance:function(){var E=this.meta.className();var D=B[E];if(D){return D}A=false;D=this.meta.instantiate();A=true;D.singletonInitialize();B[E]=D;return D}}})})(JooseRole);(function(A){A("Joose.SimpleRequest",{has:{_req:{}},methods:{initialize:function(){if(window.XMLHttpRequest){this._req=new XMLHttpRequest()}else{this._req=new ActiveXObject("Microsoft.XMLHTTP")}},getText:function(E,D,I,C){var F=this._req;var H;var B;if(typeof E!="string"){H=E.headers;B=E.url;D=D||E.async;I=I||E.callback;C=C||E.scope}else{B=E}F.open("GET",B,D||false);if(H){Joose.O.eachSafe(H,function(K,J){F.setRequestHeader(J,K)})}try{F.onreadystatechange=function(J){if(D&&F.readyState==4){if(F.status==200||F.status==0){I.call(C||this,true,F.responseText)}else{I.call(C||this,false,"File not found: "+B)}}};F.send(null)}catch(G){throw"File not found: "+B}if(!D){if(F.status==200||F.status==0){return F.responseText}else{throw"File not found: "+B}}return null}}})})(JooseClass);(function(A){A("Joose.Gears",{isa:Joose.Class,has:{wp:{},calls:{init:{}},callIndex:{init:0}},after:{initialize:function(){JooseGearsInitializeGears();if(this.canGears()){this.wp=google.gears.factory.create("beta.workerpool");var B=this;this.wp.onmessage=function(D,C,E){B.handleGearsMessage(E)}}}},methods:{handlePropworkers:function(C){var B=this;Joose.O.eachSafe(C,function(E,D){B.addWorker(D,E)})},handleGearsMessage:function(E){var D=E.body;var F=D.to;var C=D.ret;var B=this.calls[D.index];if(B.meta.can(F)){B[F].call(B,C)}},canGears:function(){return window.google&&window.google.gears&&window.google.gears.factory},addWorker:function(C,D,I){var E="on"+Joose.S.uppercaseFirst(C);var L=this.meta.getClassObject().ajaxRequest;if(!this.canGears()){var J=function(){var P=this;var O={sendReturn:function(Q,R){if(P.meta.can(R)){P[R].call(P,Q)}},clientHasGears:function(){return false},ajaxRequest:L};var N=D.apply(O,arguments);O.sendReturn(N,E)};this.addMethod(C,J,I);return}var G=this.can("jsonURL")?this.c.jsonURL():"json2.js";var M=new Joose.SimpleRequest().getText(G);var B="var timer = google.gears.factory.create('beta.timer');\nfunction aClass () {}; aClass.prototype."+C+" = "+D.toString()+"\n\naClass.prototype.clientHasGears = function () { return true }\naClass.prototype.ajaxRequest = "+L.toString()+"\n\nvar wp = google.gears.workerPool;\nwp.onmessage = function (a,b,message) {\nvar paras = message.body;\nvar o = new aClass();\no.sendReturn = function (ret, cbName) { wp.sendMessage({ ret: ret, to: cbName, index: paras.index }, message.sender) } \nvar ret = o."+C+".apply(o, paras.args); if(!ret) ret = null; \no.sendReturn(ret, paras.cbName);\n}\n\n";B+=M;var K=this.wp;var F=K.createWorker(B);var H=this;var J=function(){var N=[];for(var O=0;O<arguments.length;O++){N.push(arguments[O])}var P={args:N,cbName:E,index:H.callIndex};K.sendMessage(P,F);H.calls[H.callIndex]=this;H.callIndex++};this.addMethod(C,J,I)}},classMethods:{setupGearsCompat:function(){window.timer={setTimeout:function(B,C){return window.setTimeout(B,C)},setInterval:function(B,C){return window.setInterval(B,C)},clearTimeout:function(B){return window.clearTimeout(B)},clearInterval:function(B){return window.clearInterval(B)}}},clientHasGears:function(){return window.google&&window.google.gears&&window.google.gears.factory},ajaxRequest:function(B,C,F,K,H){var E;if(this.clientHasGears()){E=google.gears.factory.create("beta.httprequest")}else{E=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()}var I="";if(F){for(var G in F){I+=encodeURIComponent(G)+"="+encodeURIComponent(F[G])+"&"}}var D=C;if(F&&B=="GET"){D+="?"+I}E.open(B,D,true);E.onreadystatechange=function J(){if(E.readyState==4){if(E.status>=200&&E.status<400){var L=E.responseText;K(L)}else{if(H){return H(E)}else{throw new Error("Error fetching url "+D+". Response code: "+E.status+" Response text: "+E.responseText)}}}};if(F&&B=="POST"){E.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");E.send(I)}else{I="";E.send(I)}}}})})(JooseClass);function JooseGearsInitializeGears(){if(window.google&&google.gears){return}var A=null;if(typeof GearsFactory!="undefined"){A=new GearsFactory()}else{try{A=new ActiveXObject("Gears.Factory");if(A.getBuildInfo().indexOf("ie_mobile")!=-1){A.privateSetGlobalObject(this)}}catch(B){if(navigator.mimeTypes["application/x-googlegears"]){A=document.createElement("object");A.style.display="none";A.width=0;A.height=0;A.type="application/x-googlegears";document.documentElement.appendChild(A)}}}if(!A){return}if(!window.google){google={}}if(!google.gears){google.gears={factory:A}}}(function(A,B){B("Joose.Storage",{methods:{toJSON:function(){var C=this.pack(Joose.Storage.TEMP_SEEN);return C},identity:function(){if(this.__ID__){return this.__ID__}else{return this.__ID__=Joose.Storage.OBJECT_COUNTER++}},pack:function(C){return this.meta.c.storageEngine().pack(this,C)}},classMethods:{storageEngine:function(){return Joose.Storage.Engine},unpack:function(C){return this.storageEngine().unpack(this,C)}}});B("Joose.Storage.jsonpickle",{does:Joose.Storage,classMethods:{storageEngine:function(){return Joose.Storage.Engine.jsonpickle}}});Joose.Storage.OBJECT_COUNTER=1;A("Joose.Storage.Engine",{classMethods:{pack:function(E,C){if(C){var I=E.identity();var G=C[I];if(G){return{__ID__:I}}}if(E.meta.can("prepareStorage")){E.prepareStorage()}if(C){C[E.identity()]=true}var H={__CLASS__:this.packedClassName(E),__ID__:E.identity()};var D=E.meta.getAttributes();Joose.O.eachSafe(D,function F(J,K){if(J.isPersistent()){H[K]=E[K]}});return H},unpack:function(E,D){var G=E.meta;var C=G.instantiate();var F=false;Joose.O.eachSafe(D,function H(K,I){if(I=="__CLASS__"){var J=Joose.Storage.Unpacker.packedClassNameToJSClassName(K);if(J!=C.meta.className()){throw new Error("Storage data is of wrong type "+J+". I am "+C.meta.className()+".")}F=true;return}C[I]=K});if(!F){throw new Error("Serialized data needs to include a __CLASS__ attribute.: "+D)}delete C.__ID__;if(C.meta.can("finishUnpack")){C.finishUnpack()}return C},packedClassName:function(D){if(D.meta.can("packedClassName")){return D.packedClassName()}var C=D.meta.className();var E=C.split(".");return E.join("::")}}});A("Joose.Storage.Engine.jsonpickle",{classMethods:{pack:function(E,C){if(C){var I=E.identity();var G=C[I];if(G){return{objectid__:I}}}if(E.meta.can("prepareStorage")){E.prepareStorage()}if(C){C[E.identity()]=true}var H={classname__:this.packedClassName(E),classmodule__:this.packedModuleName(E),objectid__:E.identity()};var D=E.meta.getAttributes();Joose.O.eachSafe(D,function F(J,K){if(J.isPersistent()){H[K]=E[K]}});return H},unpack:function(E,D){var G=E.meta;var C=G.instantiate();var F=false;Joose.O.eachSafe(D,function H(L,I){if(I=="classname__"){var K=L;var J=D.classmodule__;if(J){K=""+J+"."+L}if(K!=C.meta.className()){throw new Error("Storage data is of wrong type "+K+". I am "+C.meta.className()+".")}F=true;return}if(I=="classmodule__"){return}C[I]=L});if(!F){throw new Error("Serialized data needs to include a __CLASS__ attribute.: "+D)}if(C.meta.can("finishUnpack")){C.finishUnpack()}return C},packedClassName:function(D){var C=D.meta.className();var E=C.split(".");return E.pop()},packedModuleName:function(D){var C=D.meta.className();var E=C.split(".");E.pop();return E.join(".")}}});Joose.Storage.storageEngine=Joose.Storage.Engine;Joose.Storage.jsonpickle.storageEngine=Joose.Storage.Engine.jsonpickle})(JooseClass,JooseRole);(function(A){A("Joose.Storage.Unpacker",{classMethods:{unpack:function(D){var C=D.__CLASS__;if(!C){throw ("Serialized data needs to include a __CLASS__ attribute.")}var B=this.packedClassNameToJSClassName(C);var F=this.meta.classNameToClassObject(B);var E=F.unpack(D);var G;if(Joose.Storage.CACHE&&(G=D.__ID__)){Joose.Storage.CACHE[G]=E}return E},packedClassNameToJSClassName:function(B){var C=B.split("-");C=C[0].split("::");return C.join(".")},jsonParseFilter:function(B,C){if(C!=null&&typeof C=="object"){if(C.__CLASS__){return Joose.Storage.Unpacker.unpack(C)}if(C.__ID__){return Joose.Storage.CACHE[C.__ID__]}}return C},patchJSON:function(){var D=JSON.parse;var B=this.jsonParseFilter;JSON.parse=function(G,F){Joose.Storage.CACHE={};return D(G,function E(H,I){var J=I;if(F){J=F(H,I)}return B(H,J)})};var C=JSON.stringify;JSON.stringify=function(){Joose.Storage.TEMP_SEEN={};return C.apply(JSON,arguments)}}}});A("Joose.Storage.Unpacker.jsonpickle",{isa:Joose.Storage.Unpacker,classMethods:{unpack:function(D){var C=D.classname__;if(!C){throw ("Serialized data needs to include a classname__ attribute.")}var B=this.packedClassNameToJSClassName(C,D.classmodule__);var F=this.meta.classNameToClassObject(B);var E=F.unpack(D);var G;if(Joose.Storage.CACHE&&(G=D.objectid__)){Joose.Storage.CACHE[G]=E}return E},packedClassNameToJSClassName:function(D,C){var B="";if(C){B+=C+"."}B+=D;return B},jsonParseFilter:function(B,C){if(C!=null&&typeof C=="object"){if(C.classname__){return Joose.Storage.Unpacker.jsonpickle.unpack(C)}if(C.objectid__){return Joose.Storage.CACHE[C.objectid__]}}return C}}})})(JooseClass);(function(A){A("Joose.Decorator",{meta:Joose.Role,methods:{decorate:function(F,D,C){var E=this;var B=F.meta.getInstanceMethods();Joose.A.each(B,function(G){var H=G.getName();var J=D;if(!E.can(H)){var I=function(){var K=this[J];return K[H].apply(K,arguments)};if(C){I=C(H)}E.addMethod(H,I)}})},handlePropdecorates:function(C){var B=this;Joose.O.eachSafe(C,function(E,D){B.decorate(E,D)})}}});Joose.Decorator.meta.apply(Joose.Class)})(JooseClass);(function(B,A){B("Joose.TypeChecker",{classMethods:{makeTypeChecker:function(I,F,E,D){if(!I.meta){throw new Error("Isa declarations in attribute declarations must be Joose classes, roles or type constraints")}var C=false;var H=false;if(Joose.Role&&I.meta.meta.isa(Joose.Role)){C=true}else{if(Joose.TypeConstraint&&I.meta.isa(Joose.TypeConstraint)){H=true}}func=function G(M,L){try{if(F.nullable===true&&M==undefined){}else{if(H){var K=null;if(F.coerce){K=I.coerce(M)}if(K==null&&F.nullable!==true){I.validate(M)}else{M=K}}else{if(!M||!M.meta){throw new ReferenceError("The "+E+" "+D+" only accepts values that have a meta object.")}var J=C?M.meta.does(I):M.meta.isa(I);if(!J){throw new ReferenceError("The "+E+" "+D+" only accepts values that are objects of type "+I.meta.className()+".")}}}}catch(N){if(L){L.call(this,N,I)}else{throw N}}return M};return func}}})})(JooseClass,JooseType);(function(A){A("Joose.Prototype",{isa:Joose.Class,override:{initializer:function(){var B=this.SUPER();return function(){B.apply(this,arguments);var C=this.meta;this.meta=new Joose.PrototypeLazyMetaObjectProxy();this.meta.metaObject=C;this.meta.object=this}}}});A("Joose.PrototypeLazyMetaObjectProxy",{has:{metaObject:{is:"rw",isa:Joose.Class,handles:"*",handleWith:function(B){return function(){var C=this.object;C.meta=this.metaObject;C.detach();C.meta[B].apply(C.meta,arguments)}}},object:{is:"rw"}}})})(JooseClass);(function(B,A){B("Joose.TypedMethod",{isa:Joose.Method,meta:Joose.Class,has:{types:{isa:Joose.Type.Array,is:"rw",init:function(){return[]}},typeCheckers:{init:function(){return[]}}},after:{setTypes:function(){var C=this;var E=[];var D=this.getProps();Joose.A.each(this.getTypes(),function(G,F){if(G===null){E.push(null)}else{E.push(Joose.TypeChecker.makeTypeChecker(G,D,"parameter",F))}});this.typeCheckers=E}},override:{copy:function(){var C=this.SUPER();var D=[].concat(this.types);C.setTypes(D);return C}},methods:{wrapTypeChecker:function(C){var D=this;return function E(){var K=D.typeCheckers;var H=[];for(var I=0,F=K.length;I<F;++I){var G=K[I];if(G!==null){var J=arguments[I];H[I]=G(J)}else{H[I]=arguments[I]}}return C.apply(this,H)}},asFunction:function(){return this.wrapTypeChecker(this._body)}},classMethods:{newFromProps:function(D,E){var F=E.method;if(typeof F!=="function"){throw new Error("Property method in method declaration ["+D+"] must be a function.")}var C=this.meta.instantiate(D,F,E);C.setTypes(E.signature);return C}}})})(JooseClass,JooseType);Module("Joose.Type",function(){Type("MethodPatternList",{uses:Joose.Type.Array,where:function(D){var B=0;for(var A in D){var C=D[A];if(C.signature instanceof Array&&typeof C.method=="function"){B++}}return D.length==B}})});Class("Joose.MultiMethod",{isa:Joose.Method,meta:Joose.Class,has:{patterns:{is:"rw",isa:Joose.Type.MethodPatternList,init:function(){return[]}}},override:{copy:function(){var A=this.SUPER();var B=[].concat(this.getPatterns());A.setPatterns(B);return A}},methods:{getFunForSignature:function(){var B=arguments;var A=this;var D=A.getPatterns();for(var E in D){if(D.hasOwnProperty(E)){var H=D[E];var G=H.signature;var F=0;if(G.length==B.length){if(G.length>0){for(var C=0;C<G.length;C++){if(G[C] instanceof Joose.TypeConstraint&&G[C].validateBool(B[C])){F++}else{if(G[C] instanceof Object&&B[C] instanceof G[C]){F++}else{if(B[C]==G[C]){F++}}}}}if(F==G.length){return H.method}}}}return function(){throw new ReferenceError("multi-method type method call with no matching signature")}},asFunction:function(){var A=this;return function(){var D=this;var C=arguments;var B=A.getFunForSignature.apply(A,C);return B.apply(D,C)}}},classMethods:{newFromPatterns:function(A,B){method=new Joose.MultiMethod(A,function(){},{});method.setPatterns(B);return method}}});Class("Digest.MD5",{classMethods:{md5_hex:function(M){var K=0;var H=8;function F(N,Q){var P=(N&65535)+(Q&65535);var O=(N>>16)+(Q>>16)+(P>>16);return(O<<16)|(P&65535)}function J(N,O){return(N<<O)|(N>>>(32-O))}function B(S,P,O,N,R,Q){return F(J(F(F(P,S),F(N,Q)),R),O)}function G(P,O,T,S,N,R,Q){return B((O&T)|((~O)&S),P,O,N,R,Q)}function C(P,O,T,S,N,R,Q){return B((O&S)|(T&(~S)),P,O,N,R,Q)}function I(P,O,T,S,N,R,Q){return B(O^T^S,P,O,N,R,Q)}function E(P,O,T,S,N,R,Q){return B(T^(O|(~S)),P,O,N,R,Q)}function D(X,S){X[S>>5]|=128<<((S)%32);X[(((S+64)>>>9)<<4)+14]=S;var W=1732584193;var V=-271733879;var U=-1732584194;var T=271733878;for(var P=0;P<X.length;P+=16){var R=W;var Q=V;var O=U;var N=T;W=G(W,V,U,T,X[P+0],7,-680876936);T=G(T,W,V,U,X[P+1],12,-389564586);U=G(U,T,W,V,X[P+2],17,606105819);V=G(V,U,T,W,X[P+3],22,-1044525330);W=G(W,V,U,T,X[P+4],7,-176418897);T=G(T,W,V,U,X[P+5],12,1200080426);U=G(U,T,W,V,X[P+6],17,-1473231341);V=G(V,U,T,W,X[P+7],22,-45705983);W=G(W,V,U,T,X[P+8],7,1770035416);T=G(T,W,V,U,X[P+9],12,-1958414417);U=G(U,T,W,V,X[P+10],17,-42063);V=G(V,U,T,W,X[P+11],22,-1990404162);W=G(W,V,U,T,X[P+12],7,1804603682);T=G(T,W,V,U,X[P+13],12,-40341101);U=G(U,T,W,V,X[P+14],17,-1502002290);V=G(V,U,T,W,X[P+15],22,1236535329);W=C(W,V,U,T,X[P+1],5,-165796510);T=C(T,W,V,U,X[P+6],9,-1069501632);U=C(U,T,W,V,X[P+11],14,643717713);V=C(V,U,T,W,X[P+0],20,-373897302);W=C(W,V,U,T,X[P+5],5,-701558691);T=C(T,W,V,U,X[P+10],9,38016083);U=C(U,T,W,V,X[P+15],14,-660478335);V=C(V,U,T,W,X[P+4],20,-405537848);W=C(W,V,U,T,X[P+9],5,568446438);T=C(T,W,V,U,X[P+14],9,-1019803690);U=C(U,T,W,V,X[P+3],14,-187363961);V=C(V,U,T,W,X[P+8],20,1163531501);W=C(W,V,U,T,X[P+13],5,-1444681467);T=C(T,W,V,U,X[P+2],9,-51403784);U=C(U,T,W,V,X[P+7],14,1735328473);V=C(V,U,T,W,X[P+12],20,-1926607734);W=I(W,V,U,T,X[P+5],4,-378558);T=I(T,W,V,U,X[P+8],11,-2022574463);U=I(U,T,W,V,X[P+11],16,1839030562);V=I(V,U,T,W,X[P+14],23,-35309556);W=I(W,V,U,T,X[P+1],4,-1530992060);T=I(T,W,V,U,X[P+4],11,1272893353);U=I(U,T,W,V,X[P+7],16,-155497632);V=I(V,U,T,W,X[P+10],23,-1094730640);W=I(W,V,U,T,X[P+13],4,681279174);T=I(T,W,V,U,X[P+0],11,-358537222);U=I(U,T,W,V,X[P+3],16,-722521979);V=I(V,U,T,W,X[P+6],23,76029189);W=I(W,V,U,T,X[P+9],4,-640364487);T=I(T,W,V,U,X[P+12],11,-421815835);U=I(U,T,W,V,X[P+15],16,530742520);V=I(V,U,T,W,X[P+2],23,-995338651);W=E(W,V,U,T,X[P+0],6,-198630844);T=E(T,W,V,U,X[P+7],10,1126891415);U=E(U,T,W,V,X[P+14],15,-1416354905);V=E(V,U,T,W,X[P+5],21,-57434055);W=E(W,V,U,T,X[P+12],6,1700485571);T=E(T,W,V,U,X[P+3],10,-1894986606);U=E(U,T,W,V,X[P+10],15,-1051523);V=E(V,U,T,W,X[P+1],21,-2054922799);W=E(W,V,U,T,X[P+8],6,1873313359);T=E(T,W,V,U,X[P+15],10,-30611744);U=E(U,T,W,V,X[P+6],15,-1560198380);V=E(V,U,T,W,X[P+13],21,1309151649);W=E(W,V,U,T,X[P+4],6,-145523070);T=E(T,W,V,U,X[P+11],10,-1120210379);U=E(U,T,W,V,X[P+2],15,718787259);V=E(V,U,T,W,X[P+9],21,-343485551);W=F(W,R);V=F(V,Q);U=F(U,O);T=F(T,N)}return[W,V,U,T]}function A(Q){var P=[];var N=(1<<H)-1;for(var O=0;O<Q.length*H;O+=H){P[O>>5]|=(Q.charCodeAt(O/H)&N)<<(O%32)}return P}function L(P){var O=K?"0123456789ABCDEF":"0123456789abcdef";var Q="";for(var N=0;N<P.length*4;N++){Q+=O.charAt((P[N>>2]>>((N%4)*8+4))&15)+O.charAt((P[N>>2]>>((N%4)*8))&15)}return Q}return L(D(A(M),M.length*H))}}});