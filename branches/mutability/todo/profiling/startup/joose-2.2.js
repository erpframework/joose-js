Joose=function(){throw"Modules may not be instantiated."};Joose.top=this;Joose.A={each:function(D,C,B){for(var A=0;A<D.length;A++){C.call(B||this,D[A],A)}},exists:function(C,B){for(var A=0;A<C.length;A++){if(C[A]==B){return true}}return false},concat:function(A,B){A.push.apply(A,B);return A},grep:function(C,B){var A=[];Joose.A.each(C,function(D){if(B(D)){A.push(D)}});return A},remove:function(C,B){var A=[];Joose.A.each(C,function(D){if(D!==B){A.push(D)}});return A}};Joose.O={each:function(A,D,C){for(var B in A){D.call(C||this,A[B],B)}if(Joose.is_IE){Joose.A.each(["toString","constructor","hasOwnProperty"],function(E){if(A.hasOwnProperty(E)){D.call(C||this,A[E],E)}})}},eachSafe:function(A,C,B){Joose.O.each(A,function(E,D){if(A.hasOwnProperty(D)){C.call(B||this,E,D)}},B)},copy:function(A,B){Joose.O.each(A,function(D,C){B[C]=D});return B},copySafe:function(A,B){Joose.O.eachSafe(A,function(D,C){B[C]=D});return B},getMutableCopy:function(A){var B=function(){};B.prototype=A;return new B()},extend:function(B,A){return Joose.O.copy(A,B)}};try{Joose.is_IE=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)}catch(e){Joose.is_IE=false}(function(){Joose.Proto=function(){throw"Modules may not be instantiated."};Joose.Proto.Object=function(){throw"Joose.Proto.Object can't be instantiated"};var C=function(F){var E=F.caller;if(!E.SUPER){E=E.caller}if(!E.SUPER){throw"Invalid call to SUPER"}return E._original||E.SUPER[E.methodName]};Joose.Proto.Object.prototype={SUPERARG:function D(){return C(Joose.is_IE?arguments.callee:D).apply(this,arguments[0])},SUPER:function A(){return C(Joose.is_IE?arguments.callee:A).apply(this,arguments)},INNER:function B(){var E=(Joose.is_IE?arguments.callee:B).caller.caller;if(E.SUPER||E.AROUND){E=E.caller}var G=E.__INNER_STACK__;if(!G){throw"Invalid call to INNER"}var F=function(){var H=G.pop();return H?H.apply(this,arguments):undefined};F.__INNER_STACK__=G;return F.apply(this,arguments)},initialize:function(){},toString:function(){return"a "+this.meta.name}};Joose.Proto.Object.meta={methods:Joose.Proto.Object.prototype,attributes:{}};Joose.Proto.Empty=function(){throw"Joose.Proto.Empty can't be instantiated"};Joose.Proto.Empty.meta={methods:{},attributes:{}}})();(function(){Joose.Proto.Class=function(){this.initialize.apply(this,arguments)};var A={constructor:Joose.Proto.Class,superClass:null,name:null,attributes:null,methods:null,meta:null,c:null,defaultSuperClass:Joose.Proto.Object,initialize:function(B,C){this.name=B;C=C||{};this.preprocessExtend(C);this.finalizeExtend(C);this.processStem(C);if(C){this.extend(C)}},preprocessExtend:function(B){this.c=B.hasOwnProperty("constructor")?B.constructor:this.defaultClassFunctionBody();delete B.constructor;this.superClass=B.isa||this.defaultSuperClass;delete B.isa},finalizeExtend:function(B){this.processSuperClass();this.adoptConstructor()},processStem:function(){var B=this.superClass.meta;this.methods=Joose.O.getMutableCopy(B.methods);this.attributes=Joose.O.getMutableCopy(B.attributes)},defaultClassFunctionBody:function(){return function(){this.initialize.apply(this,arguments)}},processSuperClass:function(){this.c.prototype=Joose.O.getMutableCopy(this.superClass.prototype)},addMethod:function(B,C){C.SUPER=this.superClass.prototype;C.methodName=B;this.methods[B]=C;this.c.prototype[B]=C},addAttribute:function(B,C){this.attributes[B]=C;this.c.prototype[B]=C},removeMethod:function(B){delete this.methods[B];delete this.c.prototype[B]},removeAttribute:function(B){delete this.attributes[B];delete this.c.prototype[B]},hasMethod:function(B){return Boolean(this.methods[B])},hasAttribute:function(B){return typeof this.attributes[B]!="undefined"},hasOwnMethod:function(B){return this.hasMethod(B)&&this.methods.hasOwnProperty(B)},hasOwnAttribute:function(B){return this.hasAttribute(B)&&this.attributes.hasOwnProperty(B)},adoptConstructor:function(){var B=this.c;B.prototype.constructor=B;B.prototype.meta=this;B.meta=this;if(!B.hasOwnProperty("toString")){B.toString=function(){return this.meta.name}}},extend:function(B){Joose.O.eachSafe(B,function(D,C){if(C!="meta"&&C!="constructor"){if(typeof B[C]=="function"&&!B[C].meta){this.addMethod(C,D)}else{this.addAttribute(C,D)}}},this)},subClassOf:function(B,C){C=C||{};C.isa=B||this.c;return new this.constructor(null,C).c}};Joose.Proto.Class.prototype=Joose.O.getMutableCopy(Joose.Proto.Object.prototype);Joose.O.extend(Joose.Proto.Class.prototype,A);Joose.Proto.Class.prototype.meta=new Joose.Proto.Class("Joose.Proto.Class",A)})();Joose.Managed=function(){throw"Modules may not be instantiated."};Joose.Managed.Property=new Joose.Proto.Class("Joose.Managed.Property",{name:null,props:null,value:null,definedIn:null,initialize:function(A,B){this.name=A;this.props=B;this.definedIn=B.definedIn;this.computeValue(B)},computeValue:function(A){this.value=A.init},prepareApply:function(A){},apply:function(A){A[this.name]=this.value},isAppliedTo:function(A){return A[this.name]==this.value},unapply:function(A){if(!this.isAppliedTo(A)){throw"Unapply failed"}delete A[this.name]},clone:function(A){return new this.constructor(A||this.name,this.props)}}).c;Joose.Managed.Property.ConflictMarker=new Joose.Proto.Class("Joose.Managed.Property.ConflictMarker",{isa:Joose.Managed.Property,apply:function(A){throw"Attempt to apply ConflictMarker ["+this.name+"] to ["+A+"]"},unapply:function(A){throw"Attempt to unapply ConflictMarker ["+this.name+"] from ["+A+"]"}}).c;Joose.Managed.Property.Requirement=new Joose.Proto.Class("Joose.Managed.Property.Requirement",{isa:Joose.Managed.Property,apply:function(A){if(!A.meta.hasMethod(this.name)){throw"Requirement ["+this.name+"], defined in ["+this.definedIn.definedIn.name+"] is not satisfied for class ["+A+"]"}},unapply:function(A){}}).c;Joose.Managed.Property.Attribute=new Joose.Proto.Class("Joose.Managed.Property.Attribute",{isa:Joose.Managed.Property,apply:function(A){this.SUPER(A.prototype)},unapply:function(A){this.SUPER(A.prototype)}}).c;Joose.Managed.Property.MethodModifier=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier",{isa:Joose.Managed.Property,prepareWrapper:function(B,F,A,D,E,C){throw"Abstract method [prepareWrapper] of "+this+" was called"},apply:function(E){var A=this.name;var D=E.prototype.hasOwnProperty(A);var B=E.prototype[A];var C=this.prepareWrapper(A,E,this.value,B,D,E.meta.superClass.prototype);if(D){C._original=B}C._contain=this.value;E.prototype[A]=C},isAppliedTo:function(A){return A.prototype[this.name]&&A.prototype[this.name]._contain==this.value},unapply:function(A){if(!this.isAppliedTo(A)){throw"Unapply of method ["+this.name+"] from class ["+A+"] failed"}if(A.prototype[this.name]._original){A.prototype[this.name]=A.prototype[this.name]._original}else{delete A.prototype[this.name]}}}).c;Joose.Managed.Property.MethodModifier.Override=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Override",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(B,G,A,D,F,C){var E=function(){arguments.callee.CALLER=arguments.callee.caller;return A.apply(this,arguments)};E.methodName=B;E.SUPER=C;return E}}).c;Joose.Managed.Property.MethodModifier.Put=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Put",{isa:Joose.Managed.Property.MethodModifier.Override,prepareWrapper:function(B,F,A,D,E,C){if(E){throw"Method ["+B+"] is applying over something ["+D+"] in class ["+F+"]"}return this.SUPERARG(arguments)}}).c;Joose.Managed.Property.MethodModifier.After=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.After",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(B,F,A,D,E,C){return function(){arguments.callee.CALLER=arguments.callee.caller;var G=E?D.apply(this,arguments):C[B].apply(this,arguments);A.apply(this,arguments);return G}}}).c;Joose.Managed.Property.MethodModifier.Before=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Before",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(B,F,A,D,E,C){return function(){arguments.callee.CALLER=arguments.callee.caller;A.apply(this,arguments);return E?D.apply(this,arguments):C[B].apply(this,arguments)}}}).c;Joose.Managed.Property.MethodModifier.Around=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Around",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(B,G,A,D,F,C){var E=function(){arguments.callee.CALLER=arguments.callee.caller;var I=this;var H=function(){return F?D.apply(I,arguments):C[B].apply(I,arguments)};return A.apply(this,Joose.A.concat([H],arguments))};E.AROUND=true;return E}}).c;Joose.Managed.Property.MethodModifier.Augment=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Augment",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(C,H,A,E,G,D){var F=function B(){arguments.callee.CALLER=arguments.callee.caller;var K=[];var I=Joose.is_IE?arguments.callee:B;do{K.push(I.OUTER?I._contain:I);I=I.OUTER&&(I._original||I.OUTER[I.methodName])}while(I);var J=function(){return K.pop().apply(this,arguments)};J.__INNER_STACK__=K;return J.apply(this,arguments)};F.methodName=C;F.OUTER=D;return F}}).c;Joose.Managed.PropertySet=new Joose.Proto.Class("Joose.Managed.PropertySet",{isa:Joose.Managed.Property,properties:null,propertyMetaClass:Joose.Managed.Property,initialize:function(A,B){B=B||{};this.SUPER(A,B);this.properties=B.properties||{}},addProperty:function(A,B){B.definedIn=this;return this.properties[A]=new (B.meta||this.propertyMetaClass)(A,B)},addPropertyObject:function(A){return this.properties[A.name]=A},removeProperty:function(A){var B=this.properties[A];delete this.properties[A];return B},haveProperty:function(A){return typeof this.properties[A]!="undefined"},getProperty:function(A){return this.properties[A]},each:function(B,A){Joose.O.each(this.properties,function(D,C){if(typeof D!="undefined"){B.call(A||this,D,C)}})},clone:function(B){var A=Joose.O.copy(this.props,{});A.properties=Joose.O.getMutableCopy(this.properties);return new this.constructor(B||this.name,A)},cleanClone:function(B){var A=Joose.O.copy(this.props,{});A.properties={};return new this.constructor(B||this.name,A)},alias:function(A){Joose.O.each(A,function(C,B){var D=this.getProperty(B);if(D){this.addPropertyObject(D.clone(C))}},this);return this},exclude:function(A){Joose.A.each(A,function(B){if(this.properties[B]){this.properties[B]=undefined}},this);return this},flattenTo:function(A){this.each(function(D,C){var B=A.getProperty(C);if(B instanceof Joose.Managed.Property.ConflictMarker){return}if(typeof B=="undefined"){A.addPropertyObject(D);return}if(B==D){return}A.removeProperty(C);A.addProperty(C,{meta:Joose.Managed.Property.ConflictMarker})},this);return this},composeTo:function(A){this.each(function(D,C){var B=A.getProperty(C);if(typeof B=="undefined"){A.addPropertyObject(D)}});return this},composeFrom:function(){var A=this.cleanClone();Joose.A.each(arguments,function(B){var C=B;if(!(B instanceof Joose.Managed.PropertySet)){C=B.propertySet;if(B.alias||B.exclude){C=C.clone()}if(B.alias){C.alias(B.alias)}if(B.exclude){C.exclude(B.exclude)}}C.flattenTo(A)});A.composeTo(this)},prepareApply:function(A){this.each(function(B){B.prepareApply(A)})},apply:function(A){this.each(function(B){B.apply(A)})},unapply:function(A){this.each(function(B){B.unapply(A)})}}).c;(function(){var A=1;Joose.Managed.PropertySet.Mutable=new Joose.Proto.Class("Joose.Managed.PropertySet.Mutable",{isa:Joose.Managed.PropertySet,ID:null,derivatives:null,opened:1,composedFrom:null,initialize:function(B,C){this.SUPER(B,C);this.derivatives={};this.ID=A++;this.composedFrom=[]},setComposeInfo:function(){this.ensureOpen();Joose.A.each(this.composedFrom,function(B){var C=B instanceof Joose.Managed.PropertySet?B:B.propertySet;delete C.derivatives[this.ID]},this);this.composedFrom=[];this.addComposeInfo.apply(this,arguments)},addComposeInfo:function(){this.ensureOpen();Joose.A.each(arguments,function(B){this.composedFrom.push(B);var C=B instanceof Joose.Managed.PropertySet?B:B.propertySet;C.derivatives[this.ID]=this},this)},removeComposeInfo:function(){this.ensureOpen();Joose.A.each(arguments,function(B){var D=0;while(D<this.composedFrom.length){var C=this.composedFrom[D];C=C instanceof Joose.Managed.PropertySet?C:C.propertySet;if(B==C){delete C.derivatives[this.ID];this.composedFrom.splice(D,1)}else{D++}}},this)},ensureOpen:function(){if(!this.opened){throw"Mutation of closed property set: ["+this.name+"]"}},addProperty:function(B,C){this.ensureOpen();return this.SUPER(B,C)},addPropertyObject:function(B){this.ensureOpen();return this.SUPER(B)},removeProperty:function(B){this.ensureOpen();return this.SUPER(B)},composeFrom:function(){this.ensureOpen();return this.SUPERARG(this.composedFrom)},open:function(){this.opened++;if(this.opened==1){Joose.O.each(this.derivatives,function(B){B.open()});this.deCompose()}},close:function(){if(!this.opened){throw"Unmatched 'close' operation on property set: ["+this.name+"]"}if(this.opened==1){this.reCompose();Joose.O.each(this.derivatives,function(B){B.close()})}this.opened--},reCompose:function(){this.composeFrom()},deCompose:function(){this.each(function(C,B){if(C.definedIn!=this){this.removeProperty(B)}},this)}}).c})();Joose.Managed.RoleStem=function(){throw"Modules may not be instantiated."};Joose.Managed.RoleStem.Attributes=new Joose.Proto.Class("Joose.Managed.RoleStem.Attributes",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:Joose.Managed.Property.Attribute}).c;Joose.Managed.RoleStem.Methods=new Joose.Proto.Class("Joose.Managed.RoleStem.Methods",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:Joose.Managed.Property.MethodModifier.Put}).c;Joose.Managed.RoleStem.Requirements=new Joose.Proto.Class("Joose.Managed.RoleStem.Requirements",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:Joose.Managed.Property.Requirement,alias:function(){},exclude:function(){},flattenTo:function(A){this.each(function(C,B){if(!A.getProperty(B)){A.addPropertyObject(C)}},this);return this},composeTo:function(A){this.flattenTo(A);return this}}).c;Joose.Managed.RoleStem.MethodModifiers=new Joose.Proto.Class("Joose.Managed.RoleStem.MethodModifiers",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:null,addProperty:function(B,C){C.definedIn=this;var A=new C.meta(B,C);if(!this.properties[B]){this.properties[B]=[]}this.properties[B].push(A);return A},addPropertyObject:function(B){var A=B.name;if(!this.properties[A]){this.properties[A]=[]}this.properties[A].push(B);return B},removeProperty:function(B){if(!this.haveProperty(B)){return undefined}var A=this.properties[B].pop();if(!this.properties[B].length){this.SUPER(B)}return A},alias:function(){},exclude:function(){},flattenTo:function(A){this.each(function(B,C){var D=A.getProperty(C);if(typeof D=="undefined"){D=A.properties[C]=[]}Joose.A.each(B,function(E){if(!Joose.A.exists(D,E)){D.push(E)}})},this);return this},composeTo:function(A){this.flattenTo(A);return this},deCompose:function(){this.each(function(A,B){var C=0;while(C<A.length){if(A[C].definedIn!=this){A.splice(C,1)}else{C++}}},this)}}).c;Joose.Managed.PropertySet.Containable=new Joose.Proto.Class("Joose.Managed.PropertySet.Containable",{isa:Joose.Managed.PropertySet.Mutable,targetClass:null,container:null,initialize:function(A,B){this.SUPER(A,B);this.targetClass=B.targetClass;this.computeContainer()},computeContainer:function(){throw"Abstract method [computeContainer] of "+this+" was called"},addProperty:function(A,B){return this.container[A]=this.SUPER(A,B)},addPropertyObject:function(A){return this.container[A.name]=this.SUPER(A)},removeProperty:function(A){try{delete this.container[A]}catch(B){this.container[A]=undefined}return this.SUPER(A)},haveProperty:function(A){return typeof this.container[A]!="undefined"},haveOwnProperty:function(A){return this.haveProperty(A)&&this.container.hasOwnProperty(A)},getProperty:function(A){return this.container[A]},cleanClone:function(A){var B=this.SUPER(A);B.container={};return B},reCompose:function(){this.prepareApply(this.targetClass);this.SUPER();this.apply(this.targetClass)},deCompose:function(){this.unapply(this.targetClass);this.SUPER()}}).c;Joose.Managed.StemElement=function(){throw"Modules may not be instantiated."};Joose.Managed.StemElement.Attributes=new Joose.Proto.Class("Joose.Managed.StemElement.Attributes",{isa:Joose.Managed.PropertySet.Containable,propertyMetaClass:Joose.Managed.Property.Attribute,computeContainer:function(A){this.container=this.targetClass.meta.attributes}}).c;Joose.Managed.StemElement.Methods=new Joose.Proto.Class("Joose.Managed.StemElement.Methods",{isa:Joose.Managed.PropertySet.Containable,propertyMetaClass:Joose.Managed.Property.MethodModifier.Put,computeContainer:function(A){this.container=this.targetClass.meta.methods}}).c;Joose.Managed.StemElement.Requirements=new Joose.Proto.Class("Joose.Managed.StemElement.Requirements",{isa:Joose.Managed.RoleStem.Requirements,targetClass:null,initialize:function(A,B){this.SUPER(A,B);this.targetClass=B.targetClass},reCompose:function(){this.prepareApply(this.targetClass);this.SUPER();this.apply(this.targetClass)},deCompose:function(){this.unapply(this.targetClass);this.SUPER()}}).c;Joose.Managed.StemElement.MethodModifiers=new Joose.Proto.Class("Joose.Managed.StemElement.MethodModifiers",{isa:Joose.Managed.RoleStem.MethodModifiers,targetClass:null,initialize:function(A,B){this.SUPER(A,B);this.targetClass=B.targetClass},prepareApply:function(A){this.each(function(B,C){Joose.A.each(B,function(D){D.prepareApply(A)})},this)},apply:function(A){this.each(function(B,C){Joose.A.each(B,function(D){D.apply(A)})},this)},unapply:function(A){this.each(function(B,C){for(var D=B.length-1;D>=0;D--){B[D].unapply(A)}},this)},reCompose:function(){this.prepareApply(this.targetClass);this.SUPER();this.apply(this.targetClass)},deCompose:function(){this.unapply(this.targetClass);this.SUPER()}}).c;Joose.Managed.PropertySet.Composition=new Joose.Proto.Class("Joose.Managed.PropertySet.Composition",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:Joose.Managed.PropertySet.Mutable,processOrder:null,each:function(B,A){Joose.A.each(this.processOrder,function(C){B.call(A||this,this.getProperty(C),C)},this)},eachR:function(C,B){for(var A=this.processOrder.length-1;A>=0;A--){C.call(B||this,this.getProperty(this.processOrder[A]),this.processOrder[A])}},clone:function(){var A=this.cleanClone();this.each(function(B){A.addPropertyObject(B.clone())});return A},alias:function(A){this.each(function(B){B.alias(A)});return this},exclude:function(A){this.each(function(B){B.exclude(A)});return this},flattenTo:function(A){this.each(function(D,B){var C=A.getProperty(B)||A.addProperty(B,{meta:D.constructor});D.flattenTo(C)});return this},composeTo:function(A){this.each(function(D,B){var C=A.getProperty(B)||A.addProperty(B,{meta:D.constructor});D.composeTo(C)});return this},deCompose:function(){this.eachR(function(A){A.open()});this.SUPER()},reCompose:function(){this.SUPER();this.each(function(A){A.close()})}}).c;Joose.Managed.Stem=new Joose.Proto.Class("Joose.Managed.Stem",{isa:Joose.Managed.PropertySet.Composition,targetClass:null,attributesMC:Joose.Managed.StemElement.Attributes,methodsMC:Joose.Managed.StemElement.Methods,requirementsMC:Joose.Managed.StemElement.Requirements,methodsModifiersMC:Joose.Managed.StemElement.MethodModifiers,processOrder:["attributes","methods","requirements","methodsModifiers"],initialize:function(A,B){var C=this.targetClass=B.targetClass;this.SUPER(A,B);this.addProperty("attributes",{meta:this.attributesMC,targetClass:C});this.addProperty("methods",{meta:this.methodsMC,targetClass:C});this.addProperty("requirements",{meta:this.requirementsMC,targetClass:C});this.addProperty("methodsModifiers",{meta:this.methodsModifiersMC,targetClass:C})},cleanClone:function(B){var A=new this.meta.constructor(null,{isa:Joose.Proto.Empty}).c;return new this.constructor(B||this.name,{targetClass:A})}}).c;Joose.Managed.Builder=new Joose.Proto.Class("Joose.Managed.Builder",{targetClass:null,initialize:function(A){this.targetClass=A.targetClass},_buildStart:function(B,A){B.stem.open()},_extend:function(A){var B=this.targetClass;this._buildStart(B.meta,A);Joose.O.eachSafe(A,function(E,C){var D=this[C];if(!D){throw"Unknow builder ["+C+"] was used during extending of ["+B+"]"}D.call(this,B.meta,E)},this);this._buildComplete(B.meta,A)},_buildComplete:function(B,A){B.stem.close()},methods:function(A,B){Joose.O.eachSafe(B,function(D,C){A.addMethod(C,D)},this)},removeMethods:function(A,B){Joose.A.each(B,function(C){A.removeMethod(C)},this)},have:function(A,B){Joose.O.eachSafe(B,function(D,C){A.addAttribute(C,D)},this)},havenot:function(A,B){Joose.A.each(B,function(C){A.removeAttribute(C)},this)},after:function(A,B){Joose.O.each(B,function(D,C){A.addMethodModifier(C,D,Joose.Managed.Property.MethodModifier.After)},this)},before:function(A,B){Joose.O.each(B,function(D,C){A.addMethodModifier(C,D,Joose.Managed.Property.MethodModifier.Before)},this)},override:function(A,B){Joose.O.each(B,function(D,C){A.addMethodModifier(C,D,Joose.Managed.Property.MethodModifier.Override)},this)},around:function(A,B){Joose.O.each(B,function(D,C){A.addMethodModifier(C,D,Joose.Managed.Property.MethodModifier.Around)},this)},augment:function(A,B){Joose.O.each(B,function(D,C){A.addMethodModifier(C,D,Joose.Managed.Property.MethodModifier.Augment)},this)},removeModifier:function(A,B){Joose.A.each(B,function(C){A.removeMethodModifier(C)},this)},does:function(A,B){Joose.A.each(B,function(C){A.addRole(C)},this)},doesnt:function(A,B){Joose.A.each(B,function(C){A.removeRole(C)},this)}}).c;Joose.Managed.Class=new Joose.Proto.Class("Joose.Managed.Class",{isa:Joose.Proto.Class,stem:null,builder:null,initialize:function(A,B){this.SUPER(A,B);this.stem.close()},processStem:function(D){this.SUPER();var B=this.meta;var C=B.builder?B.builder.constructor:Joose.Managed.Builder;var A=B.stem?B.stem.constructor:Joose.Managed.Stem;if(this.superClass==this.constructor){C=B.subClassOf(C);A=B.subClassOf(A)}this.builder=new C({targetClass:this.c});this.stem=new A(this.name,{targetClass:this.c})},extend:function(A){if(A.builder){this.builder.meta.extend(A.builder);delete A.builder}if(A.stem){this.stem.meta.extend(A.stem);delete A.stem}this.builder._extend(A)},addMethodModifier:function(A,D,C){var B={};B.init=D;B.meta=C;return this.stem.properties.methodsModifiers.addProperty(A,B)},removeMethodModifier:function(A){return this.stem.properties.methodsModifiers.removeProperty(A)},addMethod:function(A,C,B){B=B||{};B.init=C;return this.stem.properties.methods.addProperty(A,B)},addAttribute:function(A,C,B){B=B||{};B.init=C;return this.stem.properties.attributes.addProperty(A,B)},removeMethod:function(A){return this.stem.properties.methods.removeProperty(A)},removeAttribute:function(A){return this.stem.properties.attributes.removeProperty(A)},hasMethod:function(A){return this.stem.properties.methods.haveProperty(A)},hasAttribute:function(A){return this.stem.properties.attributes.haveProperty(A)},hasOwnMethod:function(A){return this.stem.properties.methods.haveOwnProperty(A)},hasOwnAttribute:function(A){return this.stem.properties.attributes.haveOwnProperty(A)},getMethod:function(A){return this.stem.properties.methods.getProperty(A)},getAttribute:function(A){return this.stem.properties.attributes.getProperty(A)},addRole:function(){Joose.A.each(arguments,function(A){var B=A;if(!(B.meta instanceof Joose.Managed.Role)){B.propertySet=B.role.meta.stem;delete B.role}else{B=B.meta.stem}this.stem.addComposeInfo(B)},this)},removeRole:function(){Joose.A.each(arguments,function(A){this.stem.removeComposeInfo(A.meta.stem)},this)}}).c;Joose.Managed.Role=new Joose.Managed.Class("Joose.Managed.Role",{isa:Joose.Managed.Class,have:{defaultSuperClass:Joose.Proto.Empty},methods:{defaultClassFunctionBody:function(){return function(){throw"Roles cant be instantiated"}},processSuperClass:function(){if(this.superClass!=this.defaultSuperClass){throw"Roles cant inherit from anything"}},hasOwnMethod:function(A){return this.hasMethod(A)},hasOwnAttribute:function(A){return this.hasAttribute(A)},addRequirement:function(A){this.stem.properties.requirements.addProperty(A,{})}},stem:{attributesMC:Joose.Managed.RoleStem.Attributes,methodsMC:Joose.Managed.RoleStem.Methods,requirementsMC:Joose.Managed.RoleStem.Requirements,methodsModifiersMC:Joose.Managed.RoleStem.MethodModifiers},builder:{require:function(A,B){Joose.A.each(B,function(C){A.addRequirement(C)},this)}}}).c;Joose.Kernel=function(){throw"Modules may not be instantiated."};Joose.Kernel.My=new Joose.Managed.Role("Joose.Kernel.My",{have:{myClass:null},after:{processStem:function(D){var C=this.meta;var A=D.my||{};A.targetClass=this.c;delete D.my;var B=this.myClass=C.subClassOf(this.superClass.meta.myClass||C.defaultSuperClass.meta.myClass||C.defaultSuperClass,A);if(this instanceof Joose.Managed.Role){this.c.my=B.meta}else{this.c.my=new B({targetClass:this.c})}}},before:{extend:function(A){if(A.my){this.myClass.meta.extend(A.my);delete A.my}},addRole:function(){var A=this.myClass.meta.stem;A.open();Joose.A.each(arguments,function(B){var C=(B.meta instanceof Joose.Managed.Role)?B:B.role;if(C.meta.meta.hasAttribute("myClass")){A.addComposeInfo(C.my.stem)}},this);A.close()},removeRole:function(){var A=this.myClass.meta.stem;A.open();Joose.A.each(arguments,function(B){if(B.meta.meta.hasAttribute("myClass")){A.removeComposeInfo(B.my.stem)}},this);A.close()}}}).c;Joose.Managed.PropertySet.Namespace=new Joose.Proto.Class("Joose.Managed.PropertySet.Namespace",{isa:Joose.Managed.PropertySet.Containable,propertyMetaClass:null,computeContainer:function(A){this.container=this.targetClass},apply:function(){},unapply:function(){},prepareApply:function(){},addProperty:function(A,B){if(B&&B.meta&&B.meta.meta.hasAttribute("ns")){B.meta.parent=this.targetClass.meta.ns}return this.container[A]=this.properties[A]=B},addPropertyObject:function(A){}}).c;Joose.Kernel.Namespace=function(){throw"Modules may not be instantiated."};Joose.Kernel.Namespace.Able=new Joose.Managed.Role("Joose.Kernel.Namespace.Able",{have:{parent:null,localName:null,ns:null},after:{initialize:function(){this.localName=(this.name||"").split(".").pop();this.ns=new Joose.Managed.PropertySet.Namespace(this.name,{targetClass:this.c})}},methods:{copyNamespaceState:function(A){A.parent=this.parent;A.ns=this.ns}}}).c;Joose.Kernel.Class=new Joose.Managed.Class("Joose.Kernel.Class",{isa:Joose.Managed.Class,does:[Joose.Kernel.My,Joose.Kernel.Namespace.Able]}).c;Joose.Managed.Role.meta.extend({does:[Joose.Kernel.My,Joose.Kernel.Namespace.Able]});Joose.Kernel.Namespace.Keeper=new Joose.Kernel.Class("Joose.Kernel.Namespace.Keeper",{isa:Joose.Kernel.Class,have:{externalConstructor:null},methods:{defaultClassFunctionBody:function(){return function(){if(this.meta instanceof Joose.Kernel.Namespace.Keeper){throw new Error("Modules may not be instantiated.")}if(typeof this.meta.externalConstructor=="function"){this.meta.externalConstructor.apply(this,arguments);return}throw new Error("NamespaceKeeper was planted incorrectly.")}},plant:function(B){var A=this.c;A.meta.copyNamespaceState(B.meta);A.meta=B.meta;A.prototype=B.prototype;A.prototype.constructor=A;A.meta.c=A;A.meta.externalConstructor=B;if(B.meta.meta.hasAttribute("myClass")){A.my=B.my}return A}}}).c;Joose.Kernel.Namespace.Manager=new Joose.Kernel.Class("Joose.Kernel.Namespace.Manager",{my:{have:{global:null},methods:{initialize:function(){var A=this.global=new Joose.Kernel.Namespace.Keeper("",{constructor:function(){throw"Global namespace cant be instantiated"}}).c;A.meta.ns.container=Joose.top;A.meta.parent=A;A.meta.ns.addProperty("__global__",A.meta.ns);new Joose.Kernel.Namespace.Keeper("Joose",{constructor:Joose});new Joose.Kernel.Namespace.Keeper("Joose.Kernel",{constructor:Joose.Kernel});A.meta.ns.addProperty("Joose",Joose);Joose.meta.ns.addProperty("Kernel",Joose.Kernel)},getCurrent:function(){var A=50;var D="getCurrent() failed with limit="+A;var C=arguments.callee.caller;while(C&&A){if(C.__JOOSE_MODULE__){return C.__JOOSE_MODULE__}try{C=C.CALLER||C.caller}catch(B){C=null}A--}if(A){return this.global}throw D},prepare:function(B){var E=B.split(".");if(E.length&&!E[0]){E.shift()}if(!E.length){throw"Cant prepare namespace with empty name = ["+B+"]"}var D=this.getCurrent();var G=D.meta.name.split(".");if(G.length&&!G[0]){G.shift()}for(var F=0;F<E.length;F++){var C=E[F];if(C=="meta"||C=="my"||!C){throw"Module name ["+B+"] may not include a part called 'meta' or 'my' or empty part."}G.push(C);var A=G.join(".");var I=D.meta.ns.getProperty(C);if(typeof I=="undefined"){var H=new Joose.Kernel.Namespace.Keeper(A).c;D.meta.ns.addProperty(H.meta.localName,H);I=H}else{if(!(I&&I.meta&&I.meta.meta&&I.meta.meta.hasAttribute("ns"))){throw"Trying to setup module "+A+" failed. There is already something: "+I}}D=I}return D},executeIn:function(C,D,B,E){var A=function(G,F){arguments.callee.__JOOSE_MODULE__=F;return G.apply(B||this,E||[])};return A(D,C)},create:function(C,D,A){var B=this.prepare(C);if(B.meta.meta.hasMethod("plant")){B.meta.plant(new A(C,D).c)}else{throw"Double declaration of class is not allowed, use 'Class.meta.extend' instead"}}}}}).c;__global__.addProperty("Class",function(B,C){var A;if(C&&C.meta){A=C.meta;delete C.meta}else{if(C&&C.isa&&C.isa!=Joose.Kernel.Class){A=C.isa.meta.constructor}else{A=Joose.Kernel.Class}}return Joose.Kernel.Namespace.Manager.my.create(B,C,A)});__global__.addProperty("Role",function(A,B){return Joose.Kernel.Namespace.Manager.my.create(A,B,Joose.Managed.Role)});__global__.addProperty("Module",function(A,B){return Joose.Kernel.Namespace.Manager.my.create(A,B,Joose.Managed.Role)});